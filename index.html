<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulsar SDR Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#05050a;--surface:#0b0b12;--card:#101018;--card2:#141420;
  --border:#1a1a2a;--border2:#252535;
  --orange:#ff6535;--pink:#e8369b;--purple:#8b5cf6;--blue:#38b6ff;--cyan:#00d4ff;--green:#00e676;
  --red:#ff4757;--yellow:#ffd32a;
  --white:#eeeef8;--muted:#55556a;--muted2:#8888a8;
  --r:12px;--rs:8px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--white);font-family:'Sora',sans-serif;min-height:100vh;overflow-x:hidden;}

/* â”€â”€ AURORA â”€â”€ */
.aurora{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
.ab{position:absolute;border-radius:50%;filter:blur(100px);animation:af 18s ease-in-out infinite alternate;}
.ab1{width:500px;height:500px;background:radial-gradient(circle,rgba(255,101,53,.09),transparent 70%);top:-150px;left:-100px;}
.ab2{width:400px;height:400px;background:radial-gradient(circle,rgba(232,54,155,.07),transparent 70%);top:30%;right:-100px;animation-delay:-6s;}
.ab3{width:600px;height:600px;background:radial-gradient(circle,rgba(56,182,255,.06),transparent 70%);bottom:-200px;left:30%;animation-delay:-12s;}
@keyframes af{0%{transform:translate(0,0) scale(1);}50%{transform:translate(25px,-20px) scale(1.07);}100%{transform:translate(-15px,25px) scale(.95);}}

/* â”€â”€ SCREEN SYSTEM â”€â”€ */
.screen{display:none;position:relative;z-index:1;min-height:100vh;}
.screen.active{display:flex;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-login{align-items:center;justify-content:center;padding:20px;}
.login-box{
  width:100%;max-width:420px;
  background:var(--card);border:1px solid var(--border2);
  border-radius:20px;padding:40px;
  animation:popIn .5s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn{from{opacity:0;transform:translateY(30px) scale(.96);}to{opacity:1;transform:none;}}
.login-logo{text-align:center;margin-bottom:32px;}
.ll-mark{
  font-family:'Bebas Neue';font-size:42px;letter-spacing:4px;
  background:linear-gradient(120deg,var(--orange),var(--pink) 45%,var(--purple) 75%,var(--blue));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.ll-sub{font-size:11px;color:var(--muted2);letter-spacing:3px;text-transform:uppercase;margin-top:2px;}
.login-tabs{display:grid;grid-template-columns:1fr 1fr;gap:6px;background:var(--surface);border-radius:var(--rs);padding:4px;margin-bottom:26px;}
.ltab{padding:9px;text-align:center;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;color:var(--muted2);transition:all .2s;}
.ltab.active{background:linear-gradient(135deg,var(--orange),var(--pink));color:white;}
.fi{width:100%;background:var(--surface);border:1px solid var(--border2);border-radius:var(--rs);padding:11px 14px;color:var(--white);font-family:'Sora',sans-serif;font-size:13px;outline:none;transition:border-color .2s;}
.fi:focus{border-color:rgba(255,101,53,.4);}
.fi::placeholder{color:var(--muted);}
.ff{margin-bottom:14px;}
.fl{font-size:11px;color:var(--muted2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px;}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:10px 20px;border-radius:var(--rs);font-family:'Sora',sans-serif;font-size:13px;font-weight:600;border:none;cursor:pointer;transition:all .2s;}
.btn-fire{background:linear-gradient(135deg,var(--orange),var(--pink));color:white;box-shadow:0 4px 20px rgba(255,101,53,.25);}
.btn-fire:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(255,101,53,.4);}
.btn-ghost{background:transparent;color:var(--muted2);border:1px solid var(--border2);}
.btn-ghost:hover{color:var(--white);border-color:var(--orange);}
.btn-sm{padding:7px 14px;font-size:12px;}
.btn-xs{padding:5px 10px;font-size:11px;}
.btn-green{background:rgba(0,230,118,.12);color:var(--green);border:1px solid rgba(0,230,118,.2);}
.btn-green:hover{background:rgba(0,230,118,.2);}
.btn-red{background:rgba(255,71,87,.12);color:var(--red);border:1px solid rgba(255,71,87,.2);}
.login-hint{font-size:11px;color:var(--muted);text-align:center;margin-top:16px;line-height:1.8;}
.login-hint b{color:var(--muted2);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AGENCY MASTER PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-agency{flex-direction:column;}
.agency-topbar{
  padding:14px 28px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(5,5,10,.95);backdrop-filter:blur(20px);
  position:sticky;top:0;z-index:50;
}
.agency-logo{font-family:'Bebas Neue';font-size:22px;letter-spacing:3px;background:linear-gradient(120deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.agency-badge{font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(255,101,53,.15);color:var(--orange);border:1px solid rgba(255,101,53,.25);letter-spacing:1px;margin-left:10px;}
.agency-content{padding:28px;flex:1;}

/* MASTER STATS */
.master-stats{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:24px;}
.ms{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px;position:relative;overflow:hidden;transition:border-color .3s,transform .2s;}
.ms:hover{border-color:var(--border2);transform:translateY(-2px);}
.ms::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--orange),var(--pink));opacity:0;transition:opacity .3s;}
.ms:hover::before{opacity:1;}
.ms-val{font-family:'Bebas Neue';font-size:34px;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.ms-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:4px;}
.ms-sub{font-size:11px;color:var(--green);margin-top:3px;}

/* CLIENTS GRID */
.clients-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;margin-bottom:24px;}
.client-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:20px;transition:all .25s;cursor:pointer;
}
.client-card:hover{border-color:rgba(255,101,53,.35);transform:translateY(-3px);box-shadow:0 12px 40px rgba(0,0,0,.3);}
.cc-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;}
.cc-avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;}
.cc-info{flex:1;padding-left:12px;}
.cc-name{font-size:15px;font-weight:700;}
.cc-nicho{font-size:11px;color:var(--muted2);margin-top:2px;}
.status-dot{display:inline-block;width:8px;height:8px;border-radius:50%;}
.dot-active{background:var(--green);box-shadow:0 0 8px rgba(0,230,118,.5);animation:dp 2s infinite;}
.dot-trial{background:var(--yellow);}
.dot-paused{background:var(--muted);}
@keyframes dp{0%,100%{opacity:1;}50%{opacity:.4;}}
.cc-metrics{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px;}
.ccm{background:var(--surface);border-radius:var(--rs);padding:8px;text-align:center;}
.ccm-val{font-size:18px;font-weight:700;color:var(--orange);}
.ccm-lbl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:2px;}
.cc-bar{height:3px;background:var(--border);border-radius:2px;margin-bottom:12px;}
.cc-bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--orange),var(--pink));}
.cc-actions{display:flex;gap:7px;}
.plan-badge{padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:.5px;}
.plan-pro{background:rgba(139,92,246,.2);color:#b09af8;border:1px solid rgba(139,92,246,.3);}
.plan-start{background:rgba(56,182,255,.15);color:var(--blue);border:1px solid rgba(56,182,255,.25);}

/* ADD CLIENT BTN */
.add-client-card{
  background:transparent;border:2px dashed var(--border2);border-radius:var(--r);
  padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:10px;cursor:pointer;min-height:180px;transition:all .2s;color:var(--muted);
}
.add-client-card:hover{border-color:var(--orange);color:var(--orange);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLIENT PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-client{flex-direction:column;}
.sidebar{
  width:230px;background:rgba(10,10,18,.98);border-right:1px solid var(--border);
  display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;
}
.sb-logo{padding:20px 18px 16px;border-bottom:1px solid var(--border);}
.sb-brand{font-family:'Bebas Neue';font-size:22px;letter-spacing:3px;background:linear-gradient(120deg,var(--orange),var(--pink) 45%,var(--purple) 75%,var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.sb-client{font-size:11px;color:var(--muted2);margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ai-live{display:inline-flex;align-items:center;gap:5px;font-size:9px;font-weight:700;padding:2px 8px;border-radius:20px;background:rgba(0,230,118,.1);color:var(--green);border:1px solid rgba(0,230,118,.2);margin-top:6px;letter-spacing:1px;}
.pring{width:6px;height:6px;border-radius:50%;background:var(--green);animation:dp 1.5s infinite;}
.sb-nav{padding:10px 8px;flex:1;overflow-y:auto;}
.nb{display:flex;align-items:center;gap:9px;width:100%;padding:9px 10px;border-radius:var(--rs);background:none;border:none;color:var(--muted2);font-family:'Sora',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;text-align:left;margin-bottom:1px;}
.nb:hover{color:var(--white);background:rgba(255,255,255,.04);}
.nb.active{color:var(--white);background:linear-gradient(90deg,rgba(255,101,53,.15),rgba(232,54,155,.08));border-left:2px solid var(--orange);}
.nb .ni{width:18px;font-size:14px;text-align:center;}
.npill{margin-left:auto;font-size:9px;font-weight:700;padding:2px 6px;border-radius:20px;background:var(--orange);color:#000;}
.npill.g{background:var(--green);}
.sb-foot{padding:14px 18px;border-top:1px solid var(--border);}
.sb-plan{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.wa-status{display:flex;align-items:center;gap:7px;font-size:11px;color:var(--green);}

.main-panel{margin-left:230px;display:flex;flex-direction:column;min-height:100vh;}
.topbar{padding:13px 26px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,10,.95);backdrop-filter:blur(20px);position:sticky;top:0;z-index:50;}
.topbar-title{font-size:16px;font-weight:600;}
.topbar-right{display:flex;gap:8px;align-items:center;}
.content{padding:26px;flex:1;}

/* VIEWS */
.view{display:none;}
.view.active{display:block;}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px;position:relative;overflow:hidden;transition:border-color .3s,transform .2s;}
.stat:hover{border-color:var(--border2);transform:translateY(-2px);}
.stat-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;}
.stat-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;}
.stat-num{font-family:'Bebas Neue';font-size:36px;line-height:1;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.stat-sub{font-size:11px;color:var(--green);margin-top:4px;}

/* PANEL */
.panel{background:var(--card);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;}
.ph{padding:13px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.ph-t{font-size:14px;font-weight:600;display:flex;align-items:center;gap:7px;}

/* CHAT */
.chat-wrap{display:grid;grid-template-columns:1fr 340px;gap:16px;}
.chat-panel{display:flex;flex-direction:column;height:520px;}
.chat-win{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}
.bubble-row{display:flex;gap:9px;animation:su .3s ease;}
@keyframes su{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
.bubble-row.lr{flex-direction:row-reverse;}
.av{width:32px;height:32px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;}
.av.ai{background:linear-gradient(135deg,var(--orange),var(--pink));font-family:'Bebas Neue';font-size:10px;color:white;box-shadow:0 0 14px rgba(255,101,53,.3);}
.av.lead{background:var(--card2);border:1px solid var(--border2);}
.bdy{max-width:86%;}
.bsender{font-size:10px;color:var(--muted);margin-bottom:3px;}
.lr .bsender{text-align:right;}
.bubble{padding:9px 13px;border-radius:13px;font-size:13px;line-height:1.65;}
.ai-bub{background:linear-gradient(135deg,rgba(255,101,53,.1),rgba(232,54,155,.07));border:1px solid rgba(255,101,53,.18);border-radius:3px 13px 13px 13px;}
.lead-bub{background:var(--card2);border:1px solid var(--border2);border-radius:13px 3px 13px 13px;color:#c0c0d8;}
.sbadge{display:inline-flex;align-items:center;gap:4px;font-size:9px;font-weight:700;padding:2px 8px;border-radius:20px;margin-top:5px;text-transform:uppercase;letter-spacing:.5px;}
.s0{background:rgba(139,92,246,.15);color:#b09af8;border:1px solid rgba(139,92,246,.25);}
.s1{background:rgba(56,182,255,.15);color:var(--blue);border:1px solid rgba(56,182,255,.25);}
.s2{background:rgba(255,101,53,.15);color:var(--orange);border:1px solid rgba(255,101,53,.25);}
.s3{background:rgba(0,212,255,.15);color:var(--cyan);border:1px solid rgba(0,212,255,.25);}
.s4{background:rgba(232,54,155,.2);color:var(--pink);border:1px solid rgba(232,54,155,.3);}
.typing-row{display:flex;gap:9px;}
.tbub{padding:11px 14px;background:rgba(255,101,53,.07);border:1px solid rgba(255,101,53,.15);border-radius:3px 13px 13px 13px;display:flex;gap:4px;align-items:center;}
.td{width:6px;height:6px;border-radius:50%;background:var(--orange);animation:td 1.3s ease-in-out infinite;}
.td:nth-child(2){animation-delay:.2s;}.td:nth-child(3){animation-delay:.4s;}
@keyframes td{0%,60%,100%{transform:translateY(0);opacity:.4;}30%{transform:translateY(-5px);opacity:1;}}
.chat-bar{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:9px;align-items:flex-end;}
.chat-in{flex:1;background:var(--surface);border:1px solid var(--border2);border-radius:var(--rs);padding:9px 13px;color:var(--white);font-family:'Sora',sans-serif;font-size:13px;resize:none;outline:none;max-height:100px;transition:border-color .2s;}
.chat-in:focus{border-color:rgba(255,101,53,.4);}
.chat-in::placeholder{color:var(--muted);}
.send-b{width:40px;height:40px;border-radius:var(--rs);border:none;background:linear-gradient(135deg,var(--orange),var(--pink));color:white;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.send-b:hover:not(:disabled){transform:scale(1.06);box-shadow:0 0 18px rgba(255,101,53,.4);}
.send-b:disabled{opacity:.4;cursor:not-allowed;}

/* LEAD CARD */
.lead-panel{display:flex;flex-direction:column;gap:14px;}
.lead-info{padding:16px;}
.lead-ava{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--blue));display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 16px rgba(139,92,246,.3);margin-bottom:11px;}
.lead-name{font-size:16px;font-weight:700;}
.lead-sub{font-size:11px;color:var(--muted2);margin-top:2px;margin-bottom:12px;}
.score-row{display:flex;justify-content:space-between;font-size:11px;margin-bottom:5px;}
.score-track{height:5px;background:var(--border);border-radius:3px;}
.score-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--orange),var(--pink));box-shadow:0 0 8px rgba(255,101,53,.3);transition:width 1s cubic-bezier(.34,1.56,.64,1);}
.tags{display:flex;flex-wrap:wrap;gap:5px;margin:10px 0 12px;}
.tag{font-size:10px;padding:3px 8px;border-radius:20px;border:1px solid var(--border2);color:var(--muted2);}
.ac-row{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
.ac-btn{padding:8px;border-radius:var(--rs);font-size:12px;font-weight:600;cursor:pointer;border:1px solid var(--border2);background:transparent;color:var(--white);font-family:'Sora',sans-serif;display:flex;align-items:center;justify-content:center;gap:5px;transition:all .2s;}
.ac-btn:hover{background:var(--border);}
.ac-btn:disabled{opacity:.4;cursor:not-allowed;}
.ac-wa{background:rgba(0,230,118,.1);border-color:rgba(0,230,118,.2);color:var(--green);}
.ac-wa:hover:not(:disabled){background:rgba(0,230,118,.2);}

/* JOURNEY */
.jtrack{padding:14px 16px;}
.jstep{display:flex;align-items:flex-start;gap:10px;margin-bottom:11px;position:relative;}
.jstep:not(:last-child)::after{content:'';position:absolute;left:14px;top:30px;bottom:-11px;width:1px;background:linear-gradient(to bottom,var(--border2),transparent);}
.jdot{width:28px;height:28px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:11px;}
.jdot.done{background:linear-gradient(135deg,var(--orange),var(--pink));}
.jdot.now{background:rgba(56,182,255,.15);border:2px solid var(--blue);animation:np 2s infinite;}
@keyframes np{0%,100%{box-shadow:0 0 0 0 rgba(56,182,255,.4);}50%{box-shadow:0 0 0 7px rgba(56,182,255,0);}}
.jdot.todo{background:var(--border);opacity:.3;}
.ji{flex:1;}.ji-l{font-size:12px;font-weight:600;}.ji-d{font-size:10px;color:var(--muted);margin-top:1px;}

/* LEADS TABLE */
.tbl-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
th{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;text-align:left;padding:9px 12px;border-bottom:1px solid var(--border);}
td{padding:10px 12px;border-bottom:1px solid rgba(26,26,42,.6);font-size:13px;vertical-align:middle;}
tr:hover td{background:rgba(255,101,53,.025);cursor:pointer;}
.tname{font-weight:600;}.tsub{font-size:10px;color:var(--muted);margin-top:1px;}
.temp{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;}
.t-hot{background:rgba(239,68,68,.12);color:#f87171;border:1px solid rgba(239,68,68,.25);}
.t-warm{background:rgba(255,101,53,.12);color:var(--orange);border:1px solid rgba(255,101,53,.25);}
.t-cold{background:rgba(56,182,255,.12);color:var(--blue);border:1px solid rgba(56,182,255,.25);}
.pmini{display:inline-block;width:48px;height:4px;background:var(--border);border-radius:2px;vertical-align:middle;}
.pfill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--orange),var(--pink));}

/* WA SETUP */
.wa-hero{background:linear-gradient(135deg,rgba(0,230,118,.08),rgba(0,230,118,.03));border:1px solid rgba(0,230,118,.15);border-radius:var(--r);padding:20px;margin-bottom:20px;display:flex;align-items:center;gap:16px;}
.setup-steps{display:flex;flex-direction:column;gap:10px;}
.setup-step{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:15px 18px;display:flex;align-items:center;gap:14px;}
.snum{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--orange),var(--pink));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;}
.si{flex:1;}.si-t{font-size:13px;font-weight:600;}.si-d{font-size:11px;color:var(--muted);margin-top:2px;}

/* TRAINING */
.train-form{padding:20px;display:flex;flex-direction:column;gap:16px;}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
select.fi option{background:var(--card);}
textarea.fi{resize:vertical;min-height:80px;line-height:1.6;}

/* FUNNEL */
.funnel-bar{display:flex;align-items:center;gap:12px;padding:9px 12px;background:var(--surface);border-radius:var(--rs);margin-bottom:6px;}
.fb-label{font-size:12px;font-weight:600;width:100px;flex-shrink:0;}
.fb-track{flex:1;height:6px;background:var(--border);border-radius:3px;}
.fb-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--orange),var(--pink));}
.fb-count{font-family:'Bebas Neue';font-size:20px;color:var(--orange);width:40px;text-align:right;}

/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(12px);z-index:300;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-bg.open{display:flex;}
.modal{background:var(--card);border:1px solid var(--border2);border-radius:18px;width:100%;max-width:500px;padding:28px;animation:mIn .3s cubic-bezier(.34,1.56,.64,1);max-height:90vh;overflow-y:auto;}
@keyframes mIn{from{opacity:0;transform:scale(.92) translateY(20px);}to{opacity:1;transform:none;}}
.m-title{font-size:20px;font-weight:700;margin-bottom:6px;}
.m-desc{color:var(--muted);font-size:13px;margin-bottom:20px;}
.m-btns{display:flex;gap:9px;justify-content:flex-end;margin-top:6px;}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;z-index:400;background:var(--card2);border:1px solid var(--border2);border-radius:var(--r);padding:12px 18px;display:flex;align-items:center;gap:9px;font-size:13px;box-shadow:0 8px 40px rgba(0,0,0,.5);transform:translateY(70px);opacity:0;transition:all .4s cubic-bezier(.34,1.56,.64,1);pointer-events:none;}
.toast.show{transform:translateY(0);opacity:1;}

/* MISC */
.gt{background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.sec-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.sec-title{font-size:16px;font-weight:700;}
.pill{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;}
.pill-active{background:rgba(0,230,118,.12);color:var(--green);border:1px solid rgba(0,230,118,.2);}
.pill-trial{background:rgba(255,211,42,.12);color:var(--yellow);border:1px solid rgba(255,211,42,.2);}

@media(max-width:768px){
  .master-stats{grid-template-columns:repeat(2,1fr);}
  .stats-row{grid-template-columns:repeat(2,1fr);}
  .chat-wrap{grid-template-columns:1fr;}
  .sidebar{transform:translateX(-100%);transition:transform .3s;}
  .sidebar.mob-open{transform:translateX(0);}
  .main-panel{margin-left:0;}
}
::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
</style>
</head>
<body>
<div class="aurora"><div class="ab ab1"></div><div class="ab ab2"></div><div class="ab ab3"></div></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 1 â€” LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="screen-login">
  <div class="login-box">
    <div class="login-logo">
      <div class="ll-mark">PULSAR</div>
      <div class="ll-sub">SDR AI Platform</div>
    </div>
    <div class="login-tabs">
      <div class="ltab active" onclick="setLoginTab('agency',this)">ğŸ¢ AgÃªncia</div>
      <div class="ltab" onclick="setLoginTab('client',this)">ğŸª Cliente</div>
    </div>
    <div id="login-agency-form">
      <div class="ff"><label class="fl">E-mail da AgÃªncia</label><input class="fi" type="email" id="ag-email" placeholder="agencia@pulsar.com" value="admin@pulsarmarketing.com"/></div>
      <div class="ff"><label class="fl">Senha</label><input class="fi" type="password" id="ag-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="admin123"/></div>
      <button class="btn btn-fire" style="width:100%;margin-top:4px;" onclick="loginAgency()">Entrar como AgÃªncia â†’</button>
    </div>
    <div id="login-client-form" style="display:none;">
      <div class="ff"><label class="fl">E-mail</label><input class="fi" type="email" id="cl-email" placeholder="cliente@empresa.com" value="joao@clinicabella.com"/></div>
      <div class="ff"><label class="fl">Senha</label><input class="fi" type="password" id="cl-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="cliente123"/></div>
      <button class="btn btn-fire" style="width:100%;margin-top:4px;" onclick="loginClient()">Entrar como Cliente â†’</button>
    </div>
    <div class="login-hint">
      <b>Demo â€” AgÃªncia:</b> admin@pulsarmarketing.com / admin123<br>
      <b>Demo â€” Cliente:</b> joao@clinicabella.com / cliente123
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 2 â€” AGENCY MASTER PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-agency" style="flex-direction:column;">
  <div class="agency-topbar">
    <div style="display:flex;align-items:center;">
      <div class="agency-logo">PULSAR SDR</div>
      <span class="agency-badge">AGÃŠNCIA MASTER</span>
    </div>
    <div style="display:flex;gap:9px;align-items:center;">
      <span style="font-size:12px;color:var(--muted2);">Pulsar Marketing 360</span>
      <button class="btn btn-ghost btn-sm" onclick="addClientModal()">+ Novo Cliente</button>
      <button class="btn btn-ghost btn-sm" onclick="logout()">Sair</button>
    </div>
  </div>

  <div class="agency-content">
    <!-- MASTER STATS -->
    <div class="master-stats">
      <div class="ms"><div class="ms-val">5</div><div class="ms-lbl">Clientes Ativos</div><div class="ms-sub">â†‘ +2 este mÃªs</div></div>
      <div class="ms"><div class="ms-val">4.247</div><div class="ms-lbl">Leads Gerados</div><div class="ms-sub">â†‘ +23% MoM</div></div>
      <div class="ms"><div class="ms-val">612</div><div class="ms-lbl">Leads Quentes</div><div class="ms-sub">Prontos p/ fechar</div></div>
      <div class="ms"><div class="ms-val" id="mrr-val">R$6,5k</div><div class="ms-lbl">MRR (Mensalidade)</div><div class="ms-sub">â†‘ Crescendo</div></div>
      <div class="ms"><div class="ms-val">94%</div><div class="ms-lbl">Taxa Engajamento IA</div><div class="ms-sub">24/7 disponÃ­vel</div></div>
    </div>

    <!-- SECTION HEADER -->
    <div class="sec-hdr">
      <div class="sec-title">ğŸª Clientes</div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ghost btn-sm" onclick="showToast('ğŸ“Š RelatÃ³rio exportado!')">ğŸ“Š Exportar RelatÃ³rio</button>
        <button class="btn btn-fire btn-sm" onclick="addClientModal()">+ Adicionar Cliente</button>
      </div>
    </div>

    <!-- CLIENTS GRID -->
    <div class="clients-grid" id="clientsGrid"></div>

    <!-- API KEY & CONFIG DA AGÃŠNCIA -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:0;">

      <!-- API KEY PANEL -->
      <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;">
        <div style="padding:13px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;">
          <div style="font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px;">ğŸ”‘ API Key Anthropic â€” Centralizada</div>
          <span id="apiStatusBadge" style="font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(255,71,87,.12);color:#ff4757;border:1px solid rgba(255,71,87,.2);">NÃ£o configurada</span>
        </div>
        <div style="padding:20px;">
          <div style="font-size:12px;color:var(--muted2);line-height:1.65;margin-bottom:16px;background:rgba(56,182,255,.05);border:1px solid rgba(56,182,255,.1);border-radius:var(--rs);padding:11px 14px;">
            ğŸ’¡ <strong style="color:var(--white);">Esta chave Ã© usada por todos os seus clientes.</strong> Ela fica armazenada apenas aqui â€” os clientes nunca tÃªm acesso a ela.
          </div>
          <div style="margin-bottom:12px;">
            <label style="font-size:11px;color:var(--muted2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px;">Chave da API</label>
            <div style="display:flex;gap:8px;">
              <input class="fi" type="password" id="agencyApiKey" placeholder="sk-ant-api03-..." style="flex:1;" oninput="checkApiKey(this.value)"/>
              <button class="btn btn-ghost btn-sm" onclick="toggleApiKeyVisibility()">ğŸ‘</button>
            </div>
          </div>
          <div style="margin-bottom:16px;">
            <label style="font-size:11px;color:var(--muted2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px;">Modelo IA</label>
            <select class="fi" id="agencyModel">
              <option value="claude-sonnet-4-20250514">claude-sonnet-4 â€” Melhor qualidade (Recomendado)</option>
              <option value="claude-haiku-4-5-20251001">claude-haiku-4-5 â€” Mais rÃ¡pido e econÃ´mico</option>
            </select>
          </div>
          <button class="btn btn-fire" style="width:100%;justify-content:center;" onclick="saveAgencyApiKey()">ğŸ”‘ Salvar e Ativar para Todos os Clientes</button>
          <div style="font-size:11px;color:var(--muted);margin-top:10px;text-align:center;">Obtenha sua chave em <a href="https://console.anthropic.com" target="_blank" style="color:var(--blue);">console.anthropic.com</a></div>
        </div>
      </div>

      <!-- CUSTO IA EM TEMPO REAL -->
      <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;">
        <div style="padding:13px 18px;border-bottom:1px solid var(--border);">
          <div style="font-size:14px;font-weight:600;">ğŸ“Š Estimativa de Custo da IA</div>
        </div>
        <div style="padding:20px;">
          <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
            <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);">
              <span style="font-size:12px;color:var(--muted);">Clientes ativos</span>
              <span style="font-weight:700;color:var(--white);" id="activeClientsCount">5</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);">
              <span style="font-size:12px;color:var(--muted);">Custo estimado/mÃªs (IA)</span>
              <span style="font-weight:700;color:var(--orange);">~R$150â€“250</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);">
              <span style="font-size:12px;color:var(--muted);">Receita mensalidades</span>
              <span style="font-weight:700;color:var(--green);" id="mrrDisplay">R$6.495</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding:9px 12px;background:linear-gradient(90deg,rgba(0,230,118,.06),transparent);border:1px solid rgba(0,230,118,.1);border-radius:var(--rs);">
              <span style="font-size:12px;color:var(--green);">Margem lÃ­quida estimada</span>
              <span style="font-weight:700;font-size:16px;color:var(--green);">~R$6.200</span>
            </div>
          </div>
          <div style="font-size:11px;color:var(--muted);line-height:1.6;">O custo real depende do volume de conversas. Cada mensagem custa ~R$0,001â€“0,005. Um cliente com 500 conversas/mÃªs gasta ~R$30 de API.</div>
        </div>
      </div>
    </div>

    <div style="background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px;margin-top:8px;">
      <div style="font-size:14px;font-weight:700;margin-bottom:14px;">ğŸ’° Calculadora de Receita</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;">
        <div style="background:var(--surface);border-radius:var(--rs);padding:14px;text-align:center;">
          <div style="font-size:11px;color:var(--muted);margin-bottom:6px;">PLANO STARTER</div>
          <div style="font-family:'Bebas Neue';font-size:30px;" class="gt">R$999</div>
          <div style="font-size:10px;color:var(--muted);">/mÃªs por cliente</div>
          <div style="font-size:11px;color:var(--green);margin-top:6px;">5 clientes = R$4.995/mÃªs</div>
        </div>
        <div style="background:linear-gradient(135deg,rgba(255,101,53,.08),rgba(232,54,155,.05));border:1px solid rgba(255,101,53,.2);border-radius:var(--rs);padding:14px;text-align:center;">
          <div style="font-size:11px;color:var(--orange);margin-bottom:6px;">â­ PLANO PRO</div>
          <div style="font-family:'Bebas Neue';font-size:30px;" class="gt">R$1.299</div>
          <div style="font-size:10px;color:var(--muted);">/mÃªs por cliente</div>
          <div style="font-size:11px;color:var(--green);margin-top:6px;">5 clientes = R$6.495/mÃªs</div>
        </div>
        <div style="background:var(--surface);border-radius:var(--rs);padding:14px;text-align:center;">
          <div style="font-size:11px;color:var(--muted);margin-bottom:6px;">PLANO PREMIUM</div>
          <div style="font-family:'Bebas Neue';font-size:30px;" class="gt">R$1.499</div>
          <div style="font-size:10px;color:var(--muted);">/mÃªs por cliente</div>
          <div style="font-size:11px;color:var(--green);margin-top:6px;">5 clientes = R$7.495/mÃªs</div>
        </div>
      </div>
      <div style="font-size:12px;color:var(--muted);text-align:center;">ğŸ’¡ Custo real por cliente: ~R$80-150/mÃªs (API + hospedagem) â†’ Margem de <span style="color:var(--green);font-weight:700;">85%+</span></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 3 â€” CLIENT PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-client">
  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="sb-logo">
      <div class="sb-brand">PULSAR SDR</div>
      <div class="sb-client" id="sb-client-name">ClÃ­nica Bella</div>
      <div class="ai-live"><span class="pring"></span> IA ATIVA 24/7</div>
    </div>
    <div class="sb-nav">
      <button class="nb active" onclick="showView('dash',this)"><span class="ni">âš¡</span> Dashboard</button>
      <button class="nb" onclick="showView('agente',this)"><span class="ni">ğŸ¤–</span> Agente SDR <span class="npill g">LIVE</span></button>
      <button class="nb" onclick="showView('leads',this)"><span class="ni">ğŸ‘¥</span> Leads <span class="npill" id="leads-count">12</span></button>
      <button class="nb" onclick="showView('funil',this)"><span class="ni">ğŸ”»</span> Funil</button>
      <button class="nb" onclick="showView('treinamento',this)"><span class="ni">ğŸ§ </span> Treinamento IA</button>
      <button class="nb" onclick="showView('whatsapp',this)"><span class="ni">ğŸ“±</span> WhatsApp</button>
      <button class="nb" onclick="showView('config',this)"><span class="ni">âš™ï¸</span> ConfiguraÃ§Ãµes</button>

    </div>
    <div class="sb-foot">
      <div class="sb-plan">
        <span class="pill pill-active">â— Plano Pro</span>
        <button class="btn btn-ghost btn-xs" onclick="logout()">Sair</button>
      </div>
      <div class="wa-status"><div class="pring" style="width:7px;height:7px;"></div> WhatsApp conectado</div>
    </div>
  </nav>

  <!-- MAIN PANEL -->
  <div class="main-panel">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:10px;">
        <button onclick="document.getElementById('sidebar').classList.toggle('mob-open')" style="display:none;background:none;border:none;color:var(--white);font-size:18px;cursor:pointer;" id="hb">â˜°</button>
        <div class="topbar-title" id="pageTitle">Dashboard</div>
      </div>
      <div class="topbar-right">
        <button class="btn btn-fire btn-sm" onclick="showView('agente',null);resetChat()">ğŸ¤– Testar Agente</button>
      </div>
    </div>
    <div class="content">

      <!-- DASHBOARD VIEW -->
      <div class="view active" id="view-dash">
        <div class="stats-row">
          <div class="stat"><div class="stat-top"><div class="stat-lbl">Leads Qualificados</div><span>ğŸ¯</span></div><div class="stat-num">312</div><div class="stat-sub">â†‘ 23% este mÃªs</div></div>
          <div class="stat"><div class="stat-top"><div class="stat-lbl">Taxa QualificaÃ§Ã£o</div><span>ğŸ“Š</span></div><div class="stat-num">68%</div><div class="stat-sub">â†‘ 12% vs anterior</div></div>
          <div class="stat"><div class="stat-top"><div class="stat-lbl">Leads Quentes ğŸ”¥</div><span>ğŸ”¥</span></div><div class="stat-num" id="hot-count">47</div><div class="stat-sub">Prontos p/ fechar</div></div>
          <div class="stat"><div class="stat-top"><div class="stat-lbl">ConversÃµes</div><span>ğŸ’°</span></div><div class="stat-num">R$22k</div><div class="stat-sub">â†‘ 18% este mÃªs</div></div>
        </div>
        <div class="chat-wrap">
          <div class="panel chat-panel">
            <div class="ph">
              <div class="ph-t">ğŸ¤– Agente SDR â€” IA Real</div>
              <div style="display:flex;gap:7px;align-items:center;">
                <span style="font-size:10px;color:var(--muted);">Nicho:</span>
                <select id="nichoSel" class="fi" style="width:auto;padding:4px 8px;font-size:11px;" onchange="resetChat()">
                  <option value="clinica">ğŸ¥ ClÃ­nica</option>
                  <option value="restaurante">ğŸ• Restaurante</option>
                  <option value="academia">ğŸ’ª Academia</option>
                  <option value="advocacia">âš–ï¸ Advocacia</option>
                  <option value="imoveis">ğŸ  ImÃ³veis</option>
                  <option value="salao">ğŸ’‡ SalÃ£o</option>
                </select>
              </div>
            </div>
            <div class="chat-win" id="chatWin1"></div>
            <div class="chat-bar">
              <textarea class="chat-in" id="ci1" rows="1" placeholder="Digite como lead para testar..." onkeydown="hk(event,'ci1','sb1')"></textarea>
              <button class="send-b" id="sb1" onclick="sendMsg('ci1','chatWin1','sb1')">â¤</button>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:14px;">
            <div class="panel">
              <div class="ph"><div class="ph-t">ğŸ‘¤ Lead Atual</div><span id="score-display" class="gt" style="font-size:11px;font-weight:700;">â€”</span></div>
              <div class="lead-info">
                <div class="lead-ava" id="leadAva">ğŸ‘¤</div>
                <div class="lead-name" id="leadName">Aguardando...</div>
                <div class="lead-sub" id="leadSub">Inicie uma conversa</div>
                <div style="margin-bottom:10px;">
                  <div class="score-row"><span>QualificaÃ§Ã£o</span><span id="scoreVal" style="color:var(--orange);">0%</span></div>
                  <div class="score-track"><div class="score-fill" id="scoreFill" style="width:0%"></div></div>
                </div>
                <div class="tags" id="leadTags"><span class="tag">ğŸ’¬ Aguardando</span></div>
                <div class="ac-row">
                  <button class="ac-btn ac-wa" id="waBtn" onclick="openWA()" disabled>ğŸ“± WhatsApp</button>
                  <button class="ac-btn" onclick="showView('leads',null)">ğŸ“‹ CRM</button>
                </div>
              </div>
            </div>
            <div class="panel">
              <div class="ph"><div class="ph-t">ğŸ—ºï¸ Jornada</div></div>
              <div class="jtrack" id="jtrack1">
                <div class="jstep"><div class="jdot todo">ğŸ”</div><div class="ji"><div class="ji-l">ConsciÃªncia</div><div class="ji-d">Identificando problema</div></div></div>
                <div class="jstep"><div class="jdot todo">ğŸ’¡</div><div class="ji"><div class="ji-l">Interesse</div><div class="ji-d">Explorando soluÃ§Ãµes</div></div></div>
                <div class="jstep"><div class="jdot todo">âš–ï¸</div><div class="ji"><div class="ji-l">ConsideraÃ§Ã£o</div><div class="ji-d">Avaliando opÃ§Ãµes</div></div></div>
                <div class="jstep"><div class="jdot todo">ğŸ¯</div><div class="ji"><div class="ji-l">DecisÃ£o</div><div class="ji-d">Pronto para comprar</div></div></div>
                <div class="jstep"><div class="jdot todo">ğŸ¤</div><div class="ji"><div class="ji-l">Fechamento</div><div class="ji-d">Vendedor finaliza</div></div></div>
              </div>
            </div>
          </div>
        </div>
        <!-- HOT TABLE -->
        <div style="margin-top:20px;">
          <div class="sec-hdr"><div class="sec-title">ğŸ”¥ Leads Quentes</div><button class="btn btn-ghost btn-sm" onclick="showView('leads',null)">Ver Todos â†’</button></div>
          <div class="panel"><div class="tbl-wrap"><table><thead><tr><th>Lead</th><th>Temp</th><th>Score</th><th>Etapa</th><th>AÃ§Ã£o</th></tr></thead><tbody id="hotTbl"></tbody></table></div></div>
        </div>
      </div>

      <!-- AGENTE VIEW -->
      <div class="view" id="view-agente">
        <div class="sec-hdr">
          <div><div class="sec-title">ğŸ¤– Agente SDR â€” Modo Completo</div><div style="font-size:12px;color:var(--muted);margin-top:2px;">Powered by Claude AI</div></div>
          <div style="display:flex;gap:8px;">
            <select id="nichoSel2" class="fi" style="width:auto;padding:7px 10px;font-size:12px;" onchange="resetChat()">
              <option value="clinica">ğŸ¥ ClÃ­nica MÃ©dica</option><option value="restaurante">ğŸ• Restaurante</option>
              <option value="academia">ğŸ’ª Academia</option><option value="advocacia">âš–ï¸ Advocacia</option>
              <option value="imoveis">ğŸ  ImÃ³veis</option><option value="salao">ğŸ’‡ SalÃ£o</option>
            </select>
            <button class="btn btn-ghost btn-sm" onclick="resetChat()">â†º Reiniciar</button>
          </div>
        </div>
        <div class="chat-wrap">
          <div class="panel" style="display:flex;flex-direction:column;height:580px;">
            <div class="ph"><div class="ph-t">ğŸ’¬ SimulaÃ§Ã£o WhatsApp</div></div>
            <div class="chat-win" id="chatWin2" style="flex:1;height:auto;"></div>
            <div class="chat-bar">
              <textarea class="chat-in" id="ci2" rows="1" placeholder="Digite como o lead..." onkeydown="hk(event,'ci2','sb2')"></textarea>
              <button class="send-b" id="sb2" onclick="sendMsg('ci2','chatWin2','sb2')">â¤</button>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:14px;">
            <div class="panel">
              <div class="ph"><div class="ph-t">ğŸ“Š AnÃ¡lise em Tempo Real</div></div>
              <div style="padding:14px;display:flex;flex-direction:column;gap:8px;">
                <div style="display:flex;justify-content:space-between;padding:8px 11px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:11px;color:var(--muted);">Score</span><span id="sc2" style="font-weight:700;color:var(--orange);">â€”</span></div>
                <div style="display:flex;justify-content:space-between;padding:8px 11px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:11px;color:var(--muted);">Etapa</span><span id="st2" style="font-weight:600;font-size:11px;">â€”</span></div>
                <div style="display:flex;justify-content:space-between;padding:8px 11px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:11px;color:var(--muted);">Temperatura</span><span id="tp2" style="font-weight:600;font-size:11px;">â€”</span></div>
                <div style="display:flex;justify-content:space-between;padding:8px 11px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:11px;color:var(--muted);">IntenÃ§Ã£o</span><span id="in2" style="font-weight:600;font-size:11px;">â€”</span></div>
              </div>
            </div>
            <div class="panel">
              <div class="ph"><div class="ph-t">ğŸ—ºï¸ Jornada</div></div>
              <div class="jtrack" id="jtrack2">
                <div class="jstep"><div class="jdot todo">ğŸ”</div><div class="ji"><div class="ji-l">ConsciÃªncia</div></div></div>
                <div class="jstep"><div class="jdot todo">ğŸ’¡</div><div class="ji"><div class="ji-l">Interesse</div></div></div>
                <div class="jstep"><div class="jdot todo">âš–ï¸</div><div class="ji"><div class="ji-l">ConsideraÃ§Ã£o</div></div></div>
                <div class="jstep"><div class="jdot todo">ğŸ¯</div><div class="ji"><div class="ji-l">DecisÃ£o</div></div></div>
                <div class="jstep"><div class="jdot todo">ğŸ¤</div><div class="ji"><div class="ji-l">Fechamento humano</div></div></div>
              </div>
            </div>
            <button class="btn btn-fire" id="waBtn2" onclick="openWA()" disabled style="width:100%;justify-content:center;">ğŸ“± Enviar ao Vendedor</button>
          </div>
        </div>
      </div>

      <!-- LEADS VIEW -->
      <div class="view" id="view-leads">
        <div class="sec-hdr">
          <div><div class="sec-title">ğŸ‘¥ Todos os Leads</div><div style="font-size:12px;color:var(--muted);margin-top:2px);">Gerenciados pelo Agente SDR</div></div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-ghost btn-sm">â¬‡ï¸ CSV</button>
            <button class="btn btn-fire btn-sm" onclick="exportHot()">ğŸ”¥ Exportar Quentes p/ WhatsApp</button>
          </div>
        </div>
        <div class="panel"><div class="tbl-wrap"><table><thead><tr><th>Lead</th><th>Nicho</th><th>Temp</th><th>Score</th><th>Etapa</th><th>Data</th><th>AÃ§Ã£o</th></tr></thead><tbody id="allTbl"></tbody></table></div></div>
      </div>

      <!-- FUNIL VIEW -->
      <div class="view" id="view-funil">
        <div class="sec-title" style="margin-bottom:20px;">ğŸ”» Funil de Vendas</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="panel">
            <div class="ph"><div class="ph-t">ConversÃ£o por Etapa</div></div>
            <div style="padding:16px;">
              <div class="funnel-bar"><div class="fb-label">ğŸ“¢ ConsciÃªncia</div><div class="fb-track"><div class="fb-fill" style="width:100%"></div></div><div class="fb-count">312</div></div>
              <div class="funnel-bar"><div class="fb-label">ğŸ’¡ Interesse</div><div class="fb-track"><div class="fb-fill" style="width:74%"></div></div><div class="fb-count">231</div></div>
              <div class="funnel-bar"><div class="fb-label">âš–ï¸ ConsideraÃ§Ã£o</div><div class="fb-track"><div class="fb-fill" style="width:51%"></div></div><div class="fb-count">159</div></div>
              <div class="funnel-bar"><div class="fb-label">ğŸ¯ DecisÃ£o</div><div class="fb-track"><div class="fb-fill" style="width:30%"></div></div><div class="fb-count">94</div></div>
              <div class="funnel-bar" style="background:rgba(255,101,53,.05);border:1px solid rgba(255,101,53,.1);border-radius:var(--rs);"><div class="fb-label" style="color:var(--orange);">ğŸ”¥ Quente</div><div class="fb-track"><div class="fb-fill" style="width:15%"></div></div><div class="fb-count">47</div></div>
              <div class="funnel-bar"><div class="fb-label">ğŸ¤ Fechamento</div><div class="fb-track"><div class="fb-fill" style="width:8%"></div></div><div class="fb-count">24</div></div>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:14px;">
            <div class="panel">
              <div class="ph"><div class="ph-t">âš¡ Performance</div></div>
              <div style="padding:14px;display:flex;flex-direction:column;gap:8px;">
                <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:12px;color:var(--muted);">Resposta mÃ©dia</span><span style="font-weight:700;color:var(--blue);">3.2s</span></div>
                <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:12px;color:var(--muted);">Taxa engajamento</span><span style="font-weight:700;color:var(--green);">94%</span></div>
                <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:12px;color:var(--muted);">Leads/dia</span><span style="font-weight:700;color:var(--orange);">28</span></div>
                <div style="display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);"><span style="font-size:12px;color:var(--muted);">Uptime IA</span><span style="font-weight:700;color:var(--green);">100%</span></div>
              </div>
            </div>
            <div class="panel">
              <div class="ph"><div class="ph-t">ğŸ’° ROI do Cliente</div></div>
              <div style="padding:16px;text-align:center;">
                <div style="font-size:11px;color:var(--muted);margin-bottom:8px;">Receita gerada via SDR</div>
                <div style="font-family:'Bebas Neue';font-size:48px;" class="gt">R$22.400</div>
                <div style="font-size:12px;color:var(--muted);margin-top:4px;">vs R$1.299/mÃªs investido</div>
                <div style="font-size:14px;color:var(--green);font-weight:700;margin-top:8px;">ROI: 1.623% ğŸš€</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TREINAMENTO VIEW -->
      <div class="view" id="view-treinamento">
        <div class="sec-hdr"><div class="sec-title">ğŸ§  Treinamento do Agente IA</div><button class="btn btn-fire btn-sm" onclick="showToast('ğŸ’¾ Agente atualizado com sucesso!')">ğŸ’¾ Salvar</button></div>
        <div class="panel">
          <div class="ph"><div class="ph-t">âš™ï¸ ConfiguraÃ§Ã£o do Agente</div></div>
          <div class="train-form">
            <div class="ff"><label class="fl">Nome do NegÃ³cio</label><input class="fi" value="ClÃ­nica Bella EstÃ©tica"/></div>
            <div class="ff"><label class="fl">Persona do Agente SDR</label><input class="fi" value="Sofia â€” Consultora especialista em estÃ©tica e bem-estar"/></div>
            <div class="ff"><label class="fl">ServiÃ§os / Produtos</label><textarea class="fi">Tratamento para manchas, Botox, Preenchimento labial, Limpeza de pele profunda, Tratamento para celulite, Drenagem linfÃ¡tica</textarea></div>
            <div class="ff"><label class="fl">Principais ObjeÃ§Ãµes e Como Contornar</label><textarea class="fi">PreÃ§o alto â†’ Parcelamento e ROI emocional (autoestima, confianÃ§a)
"Vou pensar" â†’ Vagas limitadas, promoÃ§Ã£o por tempo limitado
Medo de dor â†’ Protocolos de conforto, depoimentos reais</textarea></div>
            <div class="ff"><label class="fl">Perguntas de QualificaÃ§Ã£o</label><textarea class="fi">Qual Ã© seu principal objetivo com o tratamento?
VocÃª jÃ¡ fez algum procedimento estÃ©tico antes?
Tem alguma data especial se aproximando?
Qual perÃ­odo prefere: manhÃ£, tarde ou noite?</textarea></div>
            <div class="row2">
              <div class="ff"><label class="fl">CTA Principal</label><input class="fi" value="Agendar avaliaÃ§Ã£o gratuita"/></div>
              <div class="ff"><label class="fl">Tom de ComunicaÃ§Ã£o</label><select class="fi"><option>AmigÃ¡vel e EmpÃ¡tico</option><option>Profissional e Formal</option><option>DescontraÃ­do e Jovial</option></select></div>
            </div>
            <div class="ff"><label class="fl">Score mÃ­nimo para alertar vendedor (%)</label><input class="fi" type="number" value="70" min="1" max="100"/></div>
            <button class="btn btn-fire" style="width:100%;justify-content:center;" onclick="showToast('ğŸ¤– Agente retreinado! MudanÃ§as aplicadas em tempo real.')">ğŸš€ Salvar e Retreinar Agente</button>
          </div>
        </div>
      </div>

      <!-- WHATSAPP VIEW -->
      <div class="view" id="view-whatsapp">
        <div class="sec-title" style="margin-bottom:20px;">ğŸ“± IntegraÃ§Ã£o WhatsApp</div>
        <div class="wa-hero">
          <span style="font-size:38px;">ğŸ“±</span>
          <div style="flex:1;">
            <div style="font-size:15px;font-weight:700;color:var(--green);">WhatsApp Business API</div>
            <div style="font-size:12px;color:var(--muted);margin-top:4px;">O agente responde automaticamente 24/7. Leads quentes sÃ£o notificados ao vendedor.</div>
            <div style="display:flex;align-items:center;gap:6px;margin-top:8px;font-size:11px;color:var(--green);"><div class="pring"></div> Conectado â€” NÃºmero: (11) 9 9999-9999</div>
          </div>
          <button class="btn btn-ghost btn-sm">Reconfigurar</button>
        </div>

        <!-- COMO CONECTAR GRÃTIS -->
        <div style="background:linear-gradient(135deg,rgba(56,182,255,.08),rgba(0,230,118,.05));border:1px solid rgba(56,182,255,.15);border-radius:var(--r);padding:18px;margin-bottom:20px;">
          <div style="font-size:14px;font-weight:700;color:var(--blue);margin-bottom:6px;">ğŸ’¡ Como conectar WhatsApp GRÃTIS (Recomendado para validaÃ§Ã£o)</div>
          <div style="font-size:13px;color:var(--muted2);line-height:1.7;">Use o <b style="color:var(--white);">Evolution API</b> (open source) + <b style="color:var(--white);">n8n</b> para conectar sem custo. O fluxo fica: Lead envia mensagem no WhatsApp â†’ n8n captura â†’ chama a IA â†’ retorna a resposta. Perfeito para os 5 primeiros clientes.</div>
        </div>

        <div style="font-size:14px;font-weight:700;margin-bottom:14px;">ğŸ”§ Setup Passo a Passo</div>
        <div class="setup-steps">
          <div class="setup-step"><div class="snum">1</div><div class="si"><div class="si-t">Instalar Evolution API (gratuito)</div><div class="si-d">Deploy no Railway.app ou Render.com â€” grÃ¡tis para comeÃ§ar. Conecta seu WhatsApp pessoal/business.</div></div><span style="color:var(--green);font-size:12px;">âœ“ Documentado</span></div>
          <div class="setup-step"><div class="snum">2</div><div class="si"><div class="si-t">Configurar n8n (automaÃ§Ã£o no-code)</div><div class="si-d">n8n.cloud grÃ¡tis atÃ© 5 fluxos. Cria o fluxo: Webhook â†’ IA â†’ WhatsApp Reply.</div></div><span style="color:var(--green);font-size:12px;">âœ“ Template pronto</span></div>
          <div class="setup-step">
            <div class="snum">3</div>
            <div class="si"><div class="si-t">Colar URL do Webhook abaixo no n8n</div><div class="si-d">Este Ã© o endpoint que recebe as mensagens e chama o agente SDR.</div></div>
            <div style="display:flex;gap:8px;align-items:center;">
              <input class="fi" value="https://pulsar-sdr.railway.app/webhook/wa" style="width:220px;font-size:11px;" readonly id="whUrl"/>
              <button class="btn btn-ghost btn-xs" onclick="copyWH()">Copiar</button>
            </div>
          </div>
          <div class="setup-step"><div class="snum">4</div><div class="si"><div class="si-t">Testar com mensagem real</div><div class="si-d">Envie "OlÃ¡" para o nÃºmero conectado e veja o agente responder em segundos.</div></div><button class="btn btn-fire btn-sm" onclick="showToast('ğŸ“± Mensagem de teste enviada!')">Testar â†’</button></div>
        </div>
      </div>

      <!-- CONFIG VIEW (cliente) â€” sem API Key, gerenciada pela agÃªncia -->
      <div class="view" id="view-config">
        <div class="sec-title" style="margin-bottom:6px;">âš™ï¸ ConfiguraÃ§Ãµes</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:24px;">ConfiguraÃ§Ãµes da sua conta no Pulsar SDR</div>
        <div style="max-width:520px;display:flex;flex-direction:column;gap:14px;">

          <!-- IA STATUS (readonly - gerenciada pela agÃªncia) -->
          <div class="panel">
            <div class="ph"><div class="ph-t">ğŸ¤– Status da InteligÃªncia Artificial</div></div>
            <div style="padding:20px;">
              <div style="display:flex;align-items:center;gap:14px;background:rgba(0,230,118,.06);border:1px solid rgba(0,230,118,.15);border-radius:var(--rs);padding:14px 16px;margin-bottom:14px;">
                <div style="width:10px;height:10px;border-radius:50%;background:var(--green);box-shadow:0 0 10px rgba(0,230,118,.5);flex-shrink:0;animation:dp 2s infinite;"></div>
                <div>
                  <div style="font-size:13px;font-weight:700;color:var(--green);">IA Ativa e Funcionando</div>
                  <div style="font-size:11px;color:var(--muted);margin-top:2px;">Gerenciada pela Pulsar Marketing 360 Â· DisponÃ­vel 24/7</div>
                </div>
              </div>
              <div style="font-size:12px;color:var(--muted);line-height:1.7;">A inteligÃªncia artificial do seu agente SDR Ã© configurada e mantida pela sua agÃªncia. VocÃª nÃ£o precisa fazer nada â€” estÃ¡ tudo funcionando automaticamente.</div>
            </div>
          </div>

          <!-- WHATSAPP DO VENDEDOR -->
          <div class="panel">
            <div class="ph"><div class="ph-t">ğŸ“± WhatsApp para Leads Quentes</div></div>
            <div style="padding:20px;">
              <div style="font-size:12px;color:var(--muted2);margin-bottom:14px;line-height:1.6;">Quando o agente qualificar um lead com score alto, ele serÃ¡ enviado automaticamente para este nÃºmero WhatsApp para o fechamento.</div>
              <div class="ff"><label class="fl">NÃºmero do vendedor (com DDI)</label><input class="fi" id="waInp" placeholder="5511999999999" value="5511999999999"/></div>
              <button class="btn btn-fire btn-sm" onclick="saveClientWA()">ğŸ’¾ Salvar nÃºmero</button>
            </div>
          </div>

          <!-- DADOS DA CONTA -->
          <div class="panel">
            <div class="ph"><div class="ph-t">ğŸ‘¤ Dados da Conta</div></div>
            <div style="padding:20px;">
              <div class="ff"><label class="fl">Nome do responsÃ¡vel</label><input class="fi" value="JoÃ£o Silva" /></div>
              <div class="ff"><label class="fl">E-mail</label><input class="fi" type="email" value="joao@clinicabella.com" /></div>
              <div class="ff"><label class="fl">Empresa</label><input class="fi" value="ClÃ­nica Bella EstÃ©tica" /></div>
              <button class="btn btn-ghost btn-sm" onclick="showToast('âœ… Dados atualizados!')">Salvar alteraÃ§Ãµes</button>
            </div>
          </div>

          <!-- SUPORTE -->
          <div class="panel">
            <div class="ph"><div class="ph-t">ğŸ†˜ Suporte</div></div>
            <div style="padding:20px;">
              <div style="font-size:13px;color:var(--muted2);margin-bottom:14px;">Precisa de ajuda? Fale direto com a Pulsar Marketing 360.</div>
              <div style="display:flex;gap:9px;">
                <button class="btn btn-green btn-sm" onclick="openSupportWA()">ğŸ“± WhatsApp da AgÃªncia</button>
                <button class="btn btn-ghost btn-sm">ğŸ“§ Enviar e-mail</button>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div><!-- content -->
  </div><!-- main-panel -->
</div><!-- screen-client -->

<!-- MODAL -->
<div class="modal-bg" id="mainModal">
  <div class="modal">
    <div class="m-title" id="mTitle">Modal</div>
    <div class="m-desc" id="mDesc"></div>
    <div id="mBody"></div>
    <div class="m-btns">
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-fire" id="mOk">Confirmar</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span id="tIcon">âœ…</span><span id="tMsg"></span></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const clients = [
  {id:1,name:'ClÃ­nica Bella',nicho:'ğŸ¥ ClÃ­nica MÃ©dica',avatar:'ğŸ¥',plan:'pro',status:'active',leads:312,hot:47,conv:24,score:78,email:'joao@clinicabella.com'},
  {id:2,name:'Restaurante Sabor',nicho:'ğŸ• Restaurante',avatar:'ğŸ•',plan:'starter',status:'active',leads:198,hot:29,conv:15,score:65,email:'pedro@sabor.com'},
  {id:3,name:'Academia FitLife',nicho:'ğŸ’ª Academia',avatar:'ğŸ’ª',plan:'pro',status:'active',leads:255,hot:38,conv:19,score:71,email:'ana@fitlife.com'},
  {id:4,name:'EscritÃ³rio Menezes',nicho:'âš–ï¸ Advocacia',avatar:'âš–ï¸',plan:'starter',status:'trial',leads:87,hot:12,conv:6,score:55,email:'rafael@menezes.com'},
  {id:5,name:'Studio Hair',nicho:'ğŸ’‡ SalÃ£o',avatar:'ğŸ’‡',plan:'pro',status:'active',leads:143,hot:21,conv:11,score:69,email:'camila@studio.com'},
];

const leadsData = [
  {name:'Roberto Alves',biz:'Dono de negÃ³cio',nicho:'ğŸ¾',temp:'hot',score:91,stage:'Pronto',date:'Hoje 14:23'},
  {name:'Mariana Costa',biz:'Prospect',nicho:'ğŸ¥',temp:'hot',score:78,stage:'DecisÃ£o',date:'Hoje 13:10'},
  {name:'Ana Lima',biz:'Arquiteta',nicho:'ğŸ ',temp:'hot',score:85,stage:'Pronto',date:'Ontem 16:20'},
  {name:'Claudia Mendes',biz:'EmpresÃ¡ria',nicho:'ğŸ•',temp:'warm',score:55,stage:'ConsideraÃ§Ã£o',date:'Hoje 11:45'},
  {name:'Paulo Ferreira',biz:'Professor',nicho:'ğŸ’ª',temp:'warm',score:61,stage:'Interesse',date:'Ontem 09:00'},
  {name:'Felipe Santos',biz:'AutÃ´nomo',nicho:'ğŸ’ª',temp:'cold',score:28,stage:'ConsciÃªncia',date:'Hoje 09:30'},
  {name:'Juliana Ramos',biz:'Designer',nicho:'ğŸ’‡',temp:'hot',score:88,stage:'Pronto',date:'Ontem 14:00'},
];

const nichoData = {
  clinica:{name:'ClÃ­nica MÃ©dica/EstÃ©tica',negocio:'ClÃ­nica Bella EstÃ©tica',persona:'Sofia, consultora de estÃ©tica',servicos:'Tratamento para manchas, Botox, Preenchimento labial, Limpeza de pele',cta:'Agendar avaliaÃ§Ã£o gratuita',tom:'empÃ¡tico e acolhedor',objecoes:'PreÃ§oâ†’parcelamento+ROI emocional | Medoâ†’seguranÃ§a e depoimentos'},
  restaurante:{name:'Restaurante/Gastronomia',negocio:'Restaurante Sabor & Arte',persona:'Carlos, maÃ®tre e consultor gastronÃ´mico',servicos:'AlmoÃ§o executivo, Jantar Ã  la carte, Eventos, Buffet corporativo',cta:'Fazer uma reserva especial',tom:'caloroso e sofisticado',objecoes:'PreÃ§oâ†’experiÃªncia Ãºnica | DistÃ¢nciaâ†’delivery premium'},
  academia:{name:'Academia/Fitness',negocio:'Academia FitLife Premium',persona:'Lucas, personal trainer e consultor fitness',servicos:'MusculaÃ§Ã£o, Personal training, Aulas coletivas, NutriÃ§Ã£o esportiva',cta:'Agendar aula experimental gratuita',tom:'motivador e energÃ©tico',objecoes:'Tempoâ†’30min transforma | PreÃ§oâ†’investimento na saÃºde'},
  advocacia:{name:'Advocacia/JurÃ­dico',negocio:'EscritÃ³rio Menezes & Associados',persona:'Dr. Rafael, consultor jurÃ­dico',servicos:'Direito trabalhista, Direito civil, Contratos, Direito do consumidor',cta:'Agendar consulta inicial gratuita',tom:'profissional e confiante',objecoes:'Custoâ†’honorÃ¡rios sÃ³ no ganho | Demoraâ†’prazos claros'},
  imoveis:{name:'ImobiliÃ¡ria',negocio:'ImobiliÃ¡ria Prime NegÃ³cios',persona:'Mariana, consultora imobiliÃ¡ria sÃªnior',servicos:'Compra e venda, Aluguel, AvaliaÃ§Ã£o, Financiamento',cta:'Agendar visita ao imÃ³vel',tom:'consultivo e seguro',objecoes:'IndecisÃ£oâ†’timing de mercado | Financiamentoâ†’parceiros bancÃ¡rios'},
  salao:{name:'SalÃ£o de Beleza',negocio:'Studio Hair & Beauty',persona:'Camila, consultora de beleza',servicos:'Corte, ColoraÃ§Ã£o, Escova, Manicure, Maquiagem, Penteados',cta:'Agendar horÃ¡rio',tom:'descontraÃ­do e criativo',objecoes:'PreÃ§oâ†’produtos premium | HorÃ¡rioâ†’agenda flexÃ­vel sÃ¡bados'},
};

const fallbackMsgs = {
  clinica:['OlÃ¡! ğŸ˜Š Que bom vocÃª entrar em contato! Para eu te ajudar da melhor forma, conta pra mim: qual Ã© o seu principal objetivo hoje com um tratamento estÃ©tico?','Entendo! Muitas clientes nossas vieram com a mesma situaÃ§Ã£o e ficaram super satisfeitas. âœ¨ VocÃª jÃ¡ tentou algum tratamento antes, ou seria sua primeira vez?','Ã“timo! Isso nos ajuda muito a montar o protocolo ideal pra vocÃª. Nossa Dra. Ana tem exatamente a expertise que vocÃª precisa. Quando teria disponibilidade para uma avaliaÃ§Ã£o gratuita essa semana?','Perfeito! ğŸ¯ 94% das nossas pacientes veem resultado jÃ¡ na 1Âª sessÃ£o. Tenho horÃ¡rio na quinta Ã s 15h ou sexta Ã s 10h â€” qual fica melhor pra vocÃª?','ğŸ”¥ Maravilha! Vou confirmar seu horÃ¡rio agora. Nossa equipe vai te enviar o endereÃ§o e todos os detalhes. VocÃª estÃ¡ fazendo uma Ã³tima escolha! âœ… [LEAD_QUENTE]'],
  restaurante:['OlÃ¡! ğŸ˜Š Bem-vindo ao Sabor & Arte! Conta pra mim, estÃ¡ procurando algo especial para hoje ou estÃ¡ planejando um evento?','Que Ã³timo! ğŸ½ï¸ Nosso chef prepara tudo com ingredientes frescos. Ã‰ para quantas pessoas aproximadamente?','Entendido! Posso te garantir uma experiÃªncia gastronÃ´mica incrÃ­vel. VocÃª prefere nosso salÃ£o principal ou Ã¡rea externa?','Perfeito! Tenho uma mesa especial disponÃ­vel. Qual seria o melhor horÃ¡rio para vocÃª? ğŸ“…','ğŸ”¥ Reserva confirmada! VocÃª vai adorar. Nossa equipe entrarÃ¡ em contato para confirmar todos os detalhes! [LEAD_QUENTE]'],
  academia:['Fala! ğŸ’ª Que bom ter vocÃª aqui! Qual Ã© seu principal objetivo agora â€” emagrecer, ganhar massa, ou melhorar o condicionamento?','Show! Esse objetivo Ã© super alcanÃ§Ã¡vel. ğŸ¯ VocÃª jÃ¡ pratica alguma atividade fÃ­sica atualmente?','Ã“timo ponto de partida! Nossa equipe de personal trainers Ã© especializada exatamente nisso. Que tal uma aula experimental gratuita para sentir na pele?','Tenho vaga amanhÃ£ Ã s 7h ou sexta Ã s 18h. Qual fica melhor? Sem compromisso â€” Ã© sÃ³ pra vocÃª conhecer! ğŸ’¥','ğŸ”¥ Agendado! VocÃª vai sair daqui transformado. Nossa equipe vai confirmar o horÃ¡rio com vocÃª agora. [LEAD_QUENTE]'],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const app = {
  // API Key Ã© carregada APENAS pela agÃªncia â€” cliente nunca acessa
  apiKey: localStorage.getItem('pulsar_agency_apikey') || '',
  model: localStorage.getItem('pulsar_agency_model') || 'claude-sonnet-4-20250514',
  waNumber: localStorage.getItem('p_wa') || '5511999999999',
  history: [],
  score: 0,
  stage: -1,
  msgCount: 0,
  currentClient: null,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLoginTab(type, el) {
  document.querySelectorAll('.ltab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('login-agency-form').style.display = type==='agency'?'block':'none';
  document.getElementById('login-client-form').style.display = type==='client'?'block':'none';
}
function loginAgency() {
  const e=document.getElementById('ag-email').value;
  const p=document.getElementById('ag-pass').value;
  if(e&&p){
    showScreen('agency');
    renderClients();
    updateMRR();
    // Load saved API key into the agency form
    const savedKey = localStorage.getItem('pulsar_agency_apikey') || '';
    const savedModel = localStorage.getItem('pulsar_agency_model') || 'claude-sonnet-4-20250514';
    const keyInput = document.getElementById('agencyApiKey');
    const modelInput = document.getElementById('agencyModel');
    if(keyInput && savedKey) keyInput.value = savedKey;
    if(modelInput && savedModel) modelInput.value = savedModel;
    updateApiStatusBadge(savedKey);
  }else showToast('âš ï¸ Preencha os campos');
}
function loginClient() {
  const e=document.getElementById('cl-email').value;
  if(e){
    const client = clients.find(c=>c.email===e)||clients[0];
    app.currentClient = client;
    // Carregar API Key da agÃªncia de forma transparente â€” cliente nunca vÃª isso
    app.apiKey = localStorage.getItem('pulsar_agency_apikey') || '';
    app.model = localStorage.getItem('pulsar_agency_model') || 'claude-sonnet-4-20250514';
    document.getElementById('sb-client-name').textContent = client.name;
    document.getElementById('leads-count').textContent = client.leads;
    document.getElementById('hot-count').textContent = client.hot;
    showScreen('client');
    renderHotTable();
    renderAllTable();
    setTimeout(()=>{ resetChat(); },200);
  }
}
function logout() { showScreen('login'); resetChat(); }

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen-'+id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AGENCY PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderClients() {
  const grid = document.getElementById('clientsGrid');
  const statusLabel={active:'â— Ativo',trial:'â— Trial'};
  const statusCls={active:'pill-active',trial:'pill-trial'};
  const planLabel={pro:'PRO',starter:'STARTER'};
  const planCls={pro:'plan-pro',starter:'plan-start'};
  const colors=['#ff6535','#38b6ff','#00e676','#e8369b','#8b5cf6'];

  grid.innerHTML = clients.map((c,i)=>`
    <div class="client-card" onclick="openClientAsAgency(${c.id})">
      <div class="cc-top">
        <div class="cc-avatar" style="background:${colors[i]}22;border:1px solid ${colors[i]}44;">${c.avatar}</div>
        <div class="cc-info">
          <div class="cc-name">${c.name}</div>
          <div class="cc-nicho">${c.nicho}</div>
        </div>
        <div>
          <span class="pill ${statusCls[c.status]}">${statusLabel[c.status]}</span><br>
          <span class="plan-badge ${planCls[c.plan]}" style="margin-top:4px;display:inline-block;">${planLabel[c.plan]}</span>
        </div>
      </div>
      <div class="cc-metrics">
        <div class="ccm"><div class="ccm-val">${c.leads}</div><div class="ccm-lbl">Leads</div></div>
        <div class="ccm"><div class="ccm-val" style="color:var(--pink);">${c.hot}</div><div class="ccm-lbl">Quentes</div></div>
        <div class="ccm"><div class="ccm-val" style="color:var(--green);">${c.conv}</div><div class="ccm-lbl">Fechados</div></div>
      </div>
      <div class="cc-bar"><div class="cc-bar-fill" style="width:${c.score}%"></div></div>
      <div class="cc-actions">
        <button class="btn btn-ghost btn-xs" onclick="event.stopPropagation();openClientAsAgency(${c.id})">ğŸ“Š Painel</button>
        <button class="btn btn-ghost btn-xs" onclick="event.stopPropagation();showToast('ğŸ“‹ RelatÃ³rio de ${c.name} gerado!')">ğŸ“‹ RelatÃ³rio</button>
        <button class="btn btn-ghost btn-xs" onclick="event.stopPropagation();showToast('ğŸ“± WhatsApp de ${c.name} aberto!')">ğŸ“± WA</button>
      </div>
    </div>
  `).join('') + `
    <div class="add-client-card" onclick="addClientModal()">
      <span style="font-size:32px;">â•</span>
      <div style="font-size:14px;font-weight:600;">Adicionar Cliente</div>
      <div style="font-size:11px;text-align:center;max-width:180px;">Configure um novo agente SDR para um cliente em minutos</div>
    </div>
  `;
}

function openClientAsAgency(id) {
  const client = clients.find(c=>c.id===id);
  app.currentClient = client;
  document.getElementById('sb-client-name').textContent = client.name;
  document.getElementById('leads-count').textContent = client.leads;
  document.getElementById('hot-count').textContent = client.hot;
  showScreen('client');
  renderHotTable();
  renderAllTable();
  setTimeout(()=>resetChat(),200);
}

function updateMRR() {
  const active = clients.filter(c=>c.status==='active').length;
  const mrr = active * 1299;
  document.getElementById('mrr-val').textContent = 'R$'+mrr.toLocaleString('pt-BR');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const titles={dash:'Dashboard',agente:'ğŸ¤– Agente SDR',leads:'ğŸ‘¥ Leads',funil:'ğŸ”» Funil',treinamento:'ğŸ§  Treinamento',whatsapp:'ğŸ“± WhatsApp',config:'âš™ï¸ ConfiguraÃ§Ãµes'};
function showView(id,btn){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  const el=document.getElementById('view-'+id);
  if(el)el.classList.add('active');
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  const pt=document.getElementById('pageTitle');
  if(pt)pt.textContent=titles[id]||id;
  document.getElementById('sidebar')?.classList.remove('mob-open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEADS TABLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHotTable(){
  const hot=leadsData.filter(l=>l.temp==='hot').slice(0,4);
  const tbody=document.getElementById('hotTbl');
  if(!tbody)return;
  tbody.innerHTML=hot.map(l=>`
    <tr>
      <td><div class="tname">${l.name}</div><div class="tsub">${l.biz}</div></td>
      <td><span class="temp t-hot">ğŸ”¥ Quente</span></td>
      <td><span class="pmini"><span class="pfill" style="width:${l.score}%"></span></span> <span style="font-size:10px;color:var(--orange);">${l.score}%</span></td>
      <td><span class="sbadge s3">${l.stage}</span></td>
      <td><button class="btn btn-green btn-xs" onclick="sendToWA('${l.name}')">ğŸ“± WA</button></td>
    </tr>
  `).join('');
}
function renderAllTable(){
  const tbody=document.getElementById('allTbl');
  if(!tbody)return;
  const tc={hot:'t-hot',warm:'t-warm',cold:'t-cold'};
  const tl={hot:'ğŸ”¥ Quente',warm:'ğŸŒ¡ï¸ Morno',cold:'â„ï¸ Frio'};
  tbody.innerHTML=leadsData.map(l=>`
    <tr>
      <td><div class="tname">${l.name}</div><div class="tsub">${l.biz}</div></td>
      <td>${l.nicho}</td>
      <td><span class="temp ${tc[l.temp]}">${tl[l.temp]}</span></td>
      <td><span class="pmini"><span class="pfill" style="width:${l.score}%"></span></span> <span style="font-size:10px;color:var(--orange);">${l.score}%</span></td>
      <td><span class="sbadge s2">${l.stage}</span></td>
      <td style="font-size:10px;color:var(--muted);">${l.date}</td>
      <td>${l.temp==='hot'?`<button class="btn btn-green btn-xs" onclick="sendToWA('${l.name}')">ğŸ“± WA</button>`:`<button class="btn btn-ghost btn-xs">Ver</button>`}</td>
    </tr>
  `).join('');
}
function exportHot(){
  const hot=leadsData.filter(l=>l.temp==='hot');
  showToast(`ğŸ“± ${hot.length} leads quentes enviados ao WhatsApp!`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI CHAT ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPrompt(nicho){
  const d=nichoData[nicho]||nichoData.clinica;
  return `VocÃª Ã© ${d.persona} trabalhando para ${d.negocio}. VocÃª Ã© um SDR especialista em ${d.name}.

SERVIÃ‡OS: ${d.servicos}
OBJETIVO: Qualificar leads e conduzi-los atÃ© o CTA: "${d.cta}". VocÃª NÃƒO fecha a venda â€” entrega leads quentes ao vendedor humano.
TOM: ${d.tom}. Mensagens curtas como WhatsApp. MÃ¡x 2-3 parÃ¡grafos. Emojis moderados.
OBJEÃ‡Ã•ES: ${d.objecoes}

FUNIL: ConsciÃªnciaâ†’Interesseâ†’ConsideraÃ§Ã£oâ†’DecisÃ£oâ†’Lead Quente
Quando o lead demonstrar alta intenÃ§Ã£o (disponibilidade + interesse real), inclua exatamente: [LEAD_QUENTE]
Nunca invente preÃ§os. NÃ£o repita a saudaÃ§Ã£o se jÃ¡ foi feita. Pergunte UMA coisa por vez.
Responda SEMPRE em portuguÃªs brasileiro.`;
}

async function callAI(msg,nicho){
  app.history.push({role:'user',content:msg});
  // API Key vem EXCLUSIVAMENTE do painel da agÃªncia â€” nunca do cliente
  const key = app.apiKey;
  if(!key){ return getFallback(nicho,app.msgCount); }
  try{
    const res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:app.model,max_tokens:800,system:buildPrompt(nicho),messages:app.history})
    });
    const data=await res.json();
    if(data.error)return getFallback(nicho,app.msgCount);
    const reply=data.content?.[0]?.text||'Desculpe, tente novamente.';
    app.history.push({role:'assistant',content:reply});
    return reply;
  }catch(e){return getFallback(nicho,app.msgCount);}
}

function getFallback(nicho,count){
  const list=fallbackMsgs[nicho]||fallbackMsgs.clinica;
  const idx=Math.min(count,list.length-1);
  return list[idx];
}

function getNicho(){
  const s1=document.getElementById('nichoSel');
  const s2=document.getElementById('nichoSel2');
  const v=document.querySelector('.view.active');
  if(v?.id==='view-agente'&&s2)return s2.value;
  return s1?.value||'clinica';
}

function getWelcome(nicho){
  const d=nichoData[nicho]||nichoData.clinica;
  const w={
    clinica:`OlÃ¡! ğŸ˜Š Seja bem-vindo Ã  ${d.negocio}! Sou ${d.persona.split(',')[0]} e estou aqui para te ajudar a encontrar o tratamento ideal. O que te trouxe atÃ© aqui hoje?`,
    restaurante:`OlÃ¡! ğŸ‘‹ Bem-vindo ao ${d.negocio}! Sou o ${d.persona.split(',')[0]}. Como posso tornar sua experiÃªncia gastronÃ´mica incrÃ­vel hoje?`,
    academia:`E aÃ­! ğŸ’ª Bem-vindo Ã  ${d.negocio}! Sou o ${d.persona.split(',')[0]}. Qual Ã© o seu objetivo de transformaÃ§Ã£o? Me conta tudo!`,
    advocacia:`OlÃ¡! ğŸ‘‹ Bem-vindo ao ${d.negocio}. Sou o ${d.persona.split(',')[0]}. Como posso te orientar hoje?`,
    imoveis:`OlÃ¡! ğŸ  Bem-vindo Ã  ${d.negocio}! Sou a ${d.persona.split(',')[0]}. O que vocÃª estÃ¡ buscando no mercado imobiliÃ¡rio?`,
    salao:`Oi! âœ¨ Bem-vindo ao ${d.negocio}! Sou a ${d.persona.split(',')[0]}. O que vocÃª quer arrasar hoje?`,
  };
  return w[nicho]||w.clinica;
}

function resetChat(){
  app.history=[];app.score=0;app.stage=-1;app.msgCount=0;
  ['chatWin1','chatWin2'].forEach(id=>{
    const el=document.getElementById(id);if(el)el.innerHTML='';
  });
  const nicho=getNicho();
  const welcome=getWelcome(nicho);
  addBubble(welcome,'ai',0,true);
  app.history.push({role:'assistant',content:welcome});
  updateScoreUI(0,-1);
  const ld=document.getElementById('leadName');if(ld)ld.textContent='Aguardando...';
  const ls=document.getElementById('leadSub');if(ls)ls.textContent='Inicie uma conversa';
  const la=document.getElementById('leadAva');if(la)la.textContent='ğŸ‘¤';
  const wb=document.getElementById('waBtn');if(wb)wb.disabled=true;
  const wb2=document.getElementById('waBtn2');if(wb2)wb2.disabled=true;
  const lt=document.getElementById('leadTags');if(lt)lt.innerHTML='<span class="tag">ğŸ’¬ Aguardando</span>';
}

async function sendMsg(inputId,winId,btnId){
  const inp=document.getElementById(inputId);
  const btn=document.getElementById(btnId);
  if(!inp||btn?.disabled)return;
  const text=inp.value.trim();if(!text)return;
  inp.value='';inp.style.height='auto';
  if(btn)btn.disabled=true;
  addBubble(text,'lead',null,true);
  showTyping(winId);
  const nicho=getNicho();
  const reply=await callAI(text,nicho);
  hideTyping(winId);
  const isHot=reply.includes('[LEAD_QUENTE]');
  app.msgCount++;
  updateScoreUI(app.msgCount,isHot?4:Math.min(Math.floor(app.msgCount/1.2),3));
  addBubble(reply,'ai',app.stage,true);
  if(isHot){
    setTimeout(()=>{
      showToast('ğŸ”¥ Lead Quente! Notificando vendedor...');
      const wb=document.getElementById('waBtn');if(wb)wb.disabled=false;
      const wb2=document.getElementById('waBtn2');if(wb2)wb2.disabled=false;
    },400);
  }
  if(btn)btn.disabled=false;
  inp.focus();
}

function addBubble(text,role,stage,scroll){
  const clean=text.replace('[LEAD_QUENTE]','').trim();
  const wins=[document.getElementById('chatWin1'),document.getElementById('chatWin2')].filter(Boolean);
  const stageCls=['s0','s1','s2','s3','s4'];
  const stageNm=['ConsciÃªncia','Interesse','ConsideraÃ§Ã£o','DecisÃ£o','ğŸ”¥ Lead Quente'];
  wins.forEach(win=>{
    const row=document.createElement('div');
    row.className='bubble-row '+(role==='lead'?'lr':'');
    row.innerHTML=`
      <div class="av ${role==='ai'?'ai':'lead'}">${role==='ai'?'SDR':'ğŸ‘¤'}</div>
      <div class="bdy">
        <div class="bsender">${role==='ai'?'SDR Pulsar â€” IA':'VocÃª (Lead)'}</div>
        <div class="bubble ${role==='ai'?'ai-bub':'lead-bub'}">${clean}</div>
        ${role==='ai'&&stage>=0?`<span class="sbadge ${stageCls[stage]}">${stageNm[stage]}</span>`:''}
      </div>`;
    win.appendChild(row);
    if(scroll)win.scrollTop=win.scrollHeight;
  });
}

function showTyping(winId){
  const wins=winId?[document.getElementById(winId)]:[document.getElementById('chatWin1'),document.getElementById('chatWin2')];
  wins.filter(Boolean).forEach(win=>{
    const r=document.createElement('div');r.className='typing-row';r.id='tr_'+win.id;
    r.innerHTML=`<div class="av ai">SDR</div><div class="tbub"><div class="td"></div><div class="td"></div><div class="td"></div></div>`;
    win.appendChild(r);win.scrollTop=win.scrollHeight;
  });
}
function hideTyping(winId){
  const id=winId?'tr_'+winId:null;
  if(id){document.getElementById(id)?.remove();}
  else{document.querySelectorAll('[id^="tr_"]').forEach(e=>e.remove());}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORE & JOURNEY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateScoreUI(msgCount,stage){
  app.stage=stage;
  let score=0;
  if(stage>=0){
    const base=[20,38,56,72,88];
    score=Math.min((base[stage]||80)+Math.floor(Math.random()*8),100);
  }
  app.score=score;
  const pct=score+'%';
  const stNames=['ConsciÃªncia','Interesse','ConsideraÃ§Ã£o','DecisÃ£o','ğŸ”¥ Quente'];
  const stColors=['var(--purple)','var(--blue)','var(--orange)','var(--cyan)','var(--pink)'];
  const tempLbls=['â„ï¸ Frio','â„ï¸ Frio','ğŸŒ¡ï¸ Morno','ğŸŒ¡ï¸ Morno','ğŸ”¥ Quente'];
  const intLbls=['â„ï¸ Baixa','â„ï¸ Baixa','ğŸŒ¡ï¸ MÃ©dia','ğŸ”¥ Alta','ğŸ”¥ Muito Alta'];

  setEl('scoreVal',pct);setEl('score-display','Score: '+pct);
  const sf=document.getElementById('scoreFill');if(sf)sf.style.width=pct;
  if(stage>=0){
    setEl('sc2',pct,'var(--orange)');
    setEl('st2',stNames[stage],stColors[stage]);
    setEl('tp2',tempLbls[stage]);
    setEl('in2',intLbls[stage]);
  }
  // Update journey tracks
  ['jtrack1','jtrack2'].forEach(tid=>{
    const t=document.getElementById(tid);if(!t)return;
    t.querySelectorAll('.jstep').forEach((s,i)=>{
      const d=s.querySelector('.jdot');d.className='jdot';
      const icons=['ğŸ”','ğŸ’¡','âš–ï¸','ğŸ¯','ğŸ¤'];
      if(i<stage){d.classList.add('done');d.textContent='âœ“';}
      else if(i===stage){d.classList.add('now');d.textContent=icons[i];}
      else{d.classList.add('todo');d.textContent=icons[i];}
    });
  });
  if(msgCount>=1){
    setEl('leadName','Lead #'+String(100+msgCount).padStart(3,'0'));
    setEl('leadSub',(nichoData[getNicho()]?.name||'Prospect')+' â€” Em qualificaÃ§Ã£o');
    const la=document.getElementById('leadAva');if(la)la.textContent='ğŸ§‘';
  }
  // Tags
  const lt=document.getElementById('leadTags');
  if(lt){
    let tags=[];
    if(score>=70)tags.push('<span class="tag" style="color:var(--orange);border-color:rgba(255,101,53,.3);">ğŸ”¥ Alta intenÃ§Ã£o</span>');
    if(stage>=3)tags.push('<span class="tag" style="color:var(--green);border-color:rgba(0,230,118,.3);">ğŸ“… DisponÃ­vel</span>');
    if(msgCount>=2)tags.push('<span class="tag">ğŸ’¬ Engajado</span>');
    lt.innerHTML=tags.join('')||'<span class="tag">ğŸ’¬ Em contato</span>';
  }
}

function setEl(id,txt,color){const e=document.getElementById(id);if(e){e.textContent=txt;if(color)e.style.color=color;}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WHATSAPP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openWA(){
  const wa=app.waNumber||'5511999999999';
  const nicho=getNicho();
  const msg=encodeURIComponent(`ğŸ”¥ *LEAD QUENTE â€” Pulsar SDR*\n\nScore: ${app.score}%\nNicho: ${nichoData[nicho]?.name||'NegÃ³cio local'}\nEtapa: Pronto para fechar\n\nğŸ“‹ O agente SDR qualificou este lead. Acesse o painel para histÃ³rico completo da conversa.\n\nâœ… Lead pronto â€” Bom fechamento! ğŸ’ª`);
  window.open(`https://wa.me/${wa}?text=${msg}`,'_blank');
}
function sendToWA(name){
  const wa=app.waNumber||'5511999999999';
  const msg=encodeURIComponent(`ğŸ”¥ *Lead Quente: ${name}*\nQualificado pelo Agente SDR Pulsar\nPronto para fechamento!`);
  window.open(`https://wa.me/${wa}?text=${msg}`,'_blank');
}
function hk(e,ci,sb){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg(ci,'chatWin1',sb);}}
function copyWH(){navigator.clipboard.writeText(document.getElementById('whUrl')?.value||'');showToast('ğŸ“‹ URL copiada!');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addClientModal(){
  document.getElementById('mTitle').textContent='â• Novo Cliente';
  document.getElementById('mDesc').textContent='Configure um novo agente SDR para um cliente da sua agÃªncia.';
  document.getElementById('mBody').innerHTML=`
    <div class="ff"><label class="fl">Nome do Cliente/Empresa</label><input class="fi" id="nc-name" placeholder="Ex: ClÃ­nica Bella EstÃ©tica"/></div>
    <div class="ff"><label class="fl">Nicho</label><select class="fi" id="nc-nicho"><option value="clinica">ğŸ¥ ClÃ­nica MÃ©dica</option><option value="restaurante">ğŸ• Restaurante</option><option value="academia">ğŸ’ª Academia</option><option value="advocacia">âš–ï¸ Advocacia</option><option value="imoveis">ğŸ  ImÃ³veis</option><option value="salao">ğŸ’‡ SalÃ£o</option></select></div>
    <div class="ff"><label class="fl">Plano</label><select class="fi" id="nc-plan"><option value="starter">Starter â€” R$999/mÃªs</option><option value="pro">Pro â€” R$1.299/mÃªs</option><option value="premium">Premium â€” R$1.499/mÃªs</option></select></div>
    <div class="ff"><label class="fl">E-mail de Acesso do Cliente</label><input class="fi" id="nc-email" placeholder="cliente@empresa.com"/></div>
  `;
  document.getElementById('mOk').onclick=confirmAddClient;
  document.getElementById('mOk').textContent='ğŸš€ Criar Cliente';
  document.getElementById('mainModal').classList.add('open');
}
function confirmAddClient(){
  const name=document.getElementById('nc-name')?.value;
  if(!name){showToast('âš ï¸ Preencha o nome');return;}
  closeModal();
  showToast(`âœ… Cliente "${name}" criado! Credenciais enviadas por e-mail.`);
  setTimeout(renderClients,500);
}
function closeModal(){document.getElementById('mainModal').classList.remove('open');}
document.getElementById('mainModal').addEventListener('click',e=>{if(e.target===document.getElementById('mainModal'))closeModal();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API KEY â€” APENAS AGÃŠNCIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveAgencyApiKey() {
  const key = document.getElementById('agencyApiKey')?.value?.trim();
  const model = document.getElementById('agencyModel')?.value;
  if(!key || !key.startsWith('sk-')){
    showToast('âš ï¸ Insira uma chave vÃ¡lida (comeÃ§a com sk-)');
    return;
  }
  localStorage.setItem('pulsar_agency_apikey', key);
  if(model) localStorage.setItem('pulsar_agency_model', model);
  app.apiKey = key;
  app.model = model || app.model;
  updateApiStatusBadge(key);
  showToast('âœ… API Key salva! Todos os clientes usando IA real agora.');
}

function checkApiKey(val) {
  updateApiStatusBadge(val);
}

function updateApiStatusBadge(key) {
  const badge = document.getElementById('apiStatusBadge');
  if(!badge) return;
  if(key && key.startsWith('sk-') && key.length > 20) {
    badge.textContent = 'âœ… Ativa';
    badge.style.background = 'rgba(0,230,118,.12)';
    badge.style.color = 'var(--green)';
    badge.style.borderColor = 'rgba(0,230,118,.2)';
  } else {
    badge.textContent = 'NÃ£o configurada';
    badge.style.background = 'rgba(255,71,87,.12)';
    badge.style.color = '#ff4757';
    badge.style.borderColor = 'rgba(255,71,87,.2)';
  }
}

function toggleApiKeyVisibility() {
  const inp = document.getElementById('agencyApiKey');
  if(!inp) return;
  inp.type = inp.type === 'password' ? 'text' : 'password';
}

function saveClientWA() {
  const wa = document.getElementById('waInp')?.value?.trim();
  if(wa) { app.waNumber = wa; localStorage.setItem('p_wa', wa); }
  showToast('âœ… NÃºmero do vendedor salvo!');
}

function openSupportWA() {
  const msg = encodeURIComponent('OlÃ¡! Preciso de suporte com o Pulsar SDR.');
  window.open('https://wa.me/5511999999999?text=' + msg, '_blank');
}

// saveConfig e showApiModal removidos â€” API Key Ã© exclusiva da agÃªncia

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg){
  document.getElementById('tMsg').textContent=msg;
  const t=document.getElementById('toast');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO-RESIZE TEXTAREAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.chat-in').forEach(inp=>{
  inp.addEventListener('input',function(){this.style.height='auto';this.style.height=Math.min(this.scrollHeight,100)+'px';});
});

// Carregar API Key da agÃªncia ao iniciar
window.addEventListener('load',()=>{
  const k = localStorage.getItem('pulsar_agency_apikey');
  if(k) app.apiKey = k;
  const m = localStorage.getItem('pulsar_agency_model');
  if(m) app.model = m;
});
</script>
</body>
</html>
