<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulsar SDR Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#05050a;--surface:#0b0b12;--card:#101018;--card2:#141420;
  --border:#1a1a2a;--border2:#252535;
  --orange:#ff6535;--pink:#e8369b;--purple:#8b5cf6;--blue:#38b6ff;--green:#00e676;
  --red:#ff4757;--yellow:#ffd32a;
  --white:#eeeef8;--muted:#55556a;--muted2:#8888a8;
  --r:12px;--rs:8px;
  --grad:linear-gradient(135deg,var(--orange),var(--pink));
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--white);font-family:'Sora',sans-serif;min-height:100vh;overflow-x:hidden;}

/* AURORA */
.aurora{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
.ab{position:absolute;border-radius:50%;filter:blur(100px);animation:af 18s ease-in-out infinite alternate;}
.ab1{width:500px;height:500px;background:radial-gradient(circle,rgba(255,101,53,.09),transparent 70%);top:-150px;left:-100px;}
.ab2{width:400px;height:400px;background:radial-gradient(circle,rgba(232,54,155,.07),transparent 70%);top:30%;right:-100px;animation-delay:-6s;}
.ab3{width:600px;height:600px;background:radial-gradient(circle,rgba(56,182,255,.06),transparent 70%);bottom:-200px;left:30%;animation-delay:-12s;}
@keyframes af{0%{transform:translate(0,0) scale(1);}50%{transform:translate(25px,-20px) scale(1.07);}100%{transform:translate(-15px,25px) scale(.95);}}

/* SCREEN SYSTEM */
.screen{display:none;position:relative;z-index:1;min-height:100vh;}
.screen.active{display:flex;}

/* ‚ïê‚ïê LOGIN ‚ïê‚ïê */
#screen-login{align-items:center;justify-content:center;padding:20px;}
.login-box{width:100%;max-width:400px;background:var(--card);border:1px solid var(--border2);border-radius:20px;padding:36px;animation:popIn .5s cubic-bezier(.34,1.56,.64,1);}
@keyframes popIn{from{opacity:0;transform:translateY(30px) scale(.96);}to{opacity:1;transform:none;}}
.login-logo{text-align:center;margin-bottom:28px;}
.ll-mark{font-family:'Bebas Neue';font-size:40px;letter-spacing:4px;background:linear-gradient(120deg,var(--orange),var(--pink) 45%,var(--purple) 75%,var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.ll-sub{font-size:11px;color:var(--muted2);letter-spacing:3px;text-transform:uppercase;margin-top:2px;}
.login-tabs{display:grid;grid-template-columns:1fr 1fr;gap:6px;background:var(--surface);border-radius:var(--rs);padding:4px;margin-bottom:24px;}
.ltab{padding:9px;text-align:center;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;color:var(--muted2);transition:all .2s;}
.ltab.active{background:var(--grad);color:white;}
.fi{width:100%;background:var(--surface);border:1px solid var(--border2);border-radius:var(--rs);padding:11px 14px;color:var(--white);font-family:'Sora',sans-serif;font-size:13px;outline:none;transition:border-color .2s;}
.fi:focus{border-color:rgba(255,101,53,.4);}
.fi::placeholder{color:var(--muted);}
.ff{margin-bottom:14px;}
.fl{font-size:11px;color:var(--muted2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px;}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:10px 20px;border-radius:var(--rs);font-family:'Sora',sans-serif;font-size:13px;font-weight:600;border:none;cursor:pointer;transition:all .2s;}
.btn-fire{background:var(--grad);color:white;box-shadow:0 4px 20px rgba(255,101,53,.25);}
.btn-fire:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(255,101,53,.4);}
.btn-ghost{background:transparent;color:var(--muted2);border:1px solid var(--border2);}
.btn-ghost:hover{color:var(--white);border-color:var(--orange);}
.btn-sm{padding:7px 14px;font-size:12px;}
.btn-xs{padding:5px 10px;font-size:11px;}
.btn-green{background:rgba(0,230,118,.12);color:var(--green);border:1px solid rgba(0,230,118,.2);}
.btn-green:hover{background:rgba(0,230,118,.2);}
.btn-red{background:rgba(255,71,87,.12);color:var(--red);border:1px solid rgba(255,71,87,.2);}
.btn-red:hover{background:rgba(255,71,87,.25);}
.login-err{font-size:12px;color:var(--red);text-align:center;margin-top:10px;display:none;}
.pw-wrap{position:relative;}
.pw-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--muted);font-size:14px;padding:2px 4px;}

/* ‚ïê‚ïê AGENCY PANEL ‚ïê‚ïê */
#screen-agency{flex-direction:column;}
.agency-topbar{padding:14px 28px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,10,.95);backdrop-filter:blur(20px);position:sticky;top:0;z-index:50;}
.agency-logo{font-family:'Bebas Neue';font-size:22px;letter-spacing:3px;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.agency-badge{font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(255,101,53,.15);color:var(--orange);border:1px solid rgba(255,101,53,.25);letter-spacing:1px;margin-left:10px;}
.agency-content{padding:28px;flex:1;}

/* MASTER STATS */
.master-stats{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:24px;}
.ms{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px;position:relative;overflow:hidden;transition:border-color .3s,transform .2s;}
.ms:hover{border-color:var(--border2);transform:translateY(-2px);}
.ms::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--grad);opacity:0;transition:opacity .3s;}
.ms:hover::before{opacity:1;}
.ms-val{font-family:'Bebas Neue';font-size:34px;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.ms-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:4px;}
.ms-sub{font-size:11px;color:var(--green);margin-top:3px;}

/* CLIENTS GRID */
.clients-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-bottom:24px;}
.client-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:20px;transition:all .25s;}
.client-card:hover{border-color:rgba(255,101,53,.3);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,.3);}
.cc-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;}
.cc-avatar{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0;}
.cc-info{flex:1;padding-left:11px;}
.cc-name{font-size:14px;font-weight:700;}
.cc-nicho{font-size:11px;color:var(--muted2);margin-top:2px;}
.cc-email{font-size:10px;color:var(--muted);margin-top:3px;}
.cc-metrics{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px;}
.ccm{background:var(--surface);border-radius:var(--rs);padding:8px;text-align:center;}
.ccm-val{font-size:17px;font-weight:700;color:var(--orange);}
.ccm-lbl{font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:2px;}
.cc-bar{height:3px;background:var(--border);border-radius:2px;margin-bottom:12px;}
.cc-bar-fill{height:100%;border-radius:2px;background:var(--grad);}
.cc-actions{display:flex;gap:6px;flex-wrap:wrap;}
.status-dot{display:inline-block;width:7px;height:7px;border-radius:50%;}
.dot-active{background:var(--green);box-shadow:0 0 8px rgba(0,230,118,.5);animation:dp 2s infinite;}
.dot-trial{background:var(--yellow);}
.dot-paused{background:var(--muted);}
@keyframes dp{0%,100%{opacity:1;}50%{opacity:.4;}}
.plan-badge{padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:.5px;}
.plan-basico{background:rgba(56,182,255,.15);color:var(--blue);border:1px solid rgba(56,182,255,.25);}
.plan-pro{background:rgba(139,92,246,.2);color:#b09af8;border:1px solid rgba(139,92,246,.3);}
.plan-premium{background:rgba(255,101,53,.15);color:var(--orange);border:1px solid rgba(255,101,53,.25);}
.pill{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;}
.pill-active{background:rgba(0,230,118,.12);color:var(--green);border:1px solid rgba(0,230,118,.2);}
.pill-trial{background:rgba(255,211,42,.12);color:var(--yellow);border:1px solid rgba(255,211,42,.2);}
.pill-paused{background:rgba(85,85,106,.15);color:var(--muted2);border:1px solid var(--border2);}
.add-client-card{background:transparent;border:2px dashed var(--border2);border-radius:var(--r);padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;cursor:pointer;min-height:200px;transition:all .2s;color:var(--muted);}
.add-client-card:hover{border-color:var(--orange);color:var(--orange);}

/* ‚ïê‚ïê CLIENT PANEL ‚ïê‚ïê */
#screen-client{flex-direction:column;}
.sidebar{width:230px;background:rgba(10,10,18,.98);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;}
.sb-logo{padding:20px 18px 16px;border-bottom:1px solid var(--border);}
.sb-brand{font-family:'Bebas Neue';font-size:22px;letter-spacing:3px;background:linear-gradient(120deg,var(--orange),var(--pink) 45%,var(--purple) 75%,var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.sb-client{font-size:11px;color:var(--muted2);margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ai-live{display:inline-flex;align-items:center;gap:5px;font-size:9px;font-weight:700;padding:2px 8px;border-radius:20px;background:rgba(0,230,118,.1);color:var(--green);border:1px solid rgba(0,230,118,.2);margin-top:6px;letter-spacing:1px;}
.pring{width:6px;height:6px;border-radius:50%;background:var(--green);animation:dp 1.5s infinite;}
.sb-nav{padding:10px 8px;flex:1;overflow-y:auto;}
.nb{display:flex;align-items:center;gap:9px;width:100%;padding:9px 10px;border-radius:var(--rs);background:none;border:none;color:var(--muted2);font-family:'Sora',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;text-align:left;margin-bottom:1px;}
.nb:hover{color:var(--white);background:rgba(255,255,255,.04);}
.nb.active{color:var(--white);background:linear-gradient(90deg,rgba(255,101,53,.15),rgba(232,54,155,.08));border-left:2px solid var(--orange);}
.nb .ni{width:18px;font-size:14px;text-align:center;}
.sb-foot{padding:14px 18px;border-top:1px solid var(--border);}
.main-panel{margin-left:230px;display:flex;flex-direction:column;min-height:100vh;}
.topbar{padding:13px 26px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(5,5,10,.95);backdrop-filter:blur(20px);position:sticky;top:0;z-index:50;}
.topbar-title{font-size:16px;font-weight:600;}
.topbar-right{display:flex;gap:8px;align-items:center;}
.content{padding:26px;flex:1;}
.view{display:none;}
.view.active{display:block;}

/* STATS */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.stat{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px;transition:border-color .3s,transform .2s;}
.stat:hover{border-color:var(--border2);transform:translateY(-2px);}
.stat-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;}
.stat-num{font-family:'Bebas Neue';font-size:36px;line-height:1;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.stat-sub{font-size:11px;color:var(--green);margin-top:4px;}

/* PANEL */
.panel{background:var(--card);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;}
.ph{padding:13px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.ph-t{font-size:14px;font-weight:600;display:flex;align-items:center;gap:7px;}

/* CHAT */
.chat-wrap{display:grid;grid-template-columns:1fr 320px;gap:16px;}
.chat-panel{display:flex;flex-direction:column;height:520px;}
.chat-win{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}
.bubble-row{display:flex;gap:9px;animation:su .3s ease;}
@keyframes su{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:none;}}
.bubble-row.lr{flex-direction:row-reverse;}
.av{width:32px;height:32px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;}
.av.ai{background:var(--grad);font-family:'Bebas Neue';font-size:10px;color:white;box-shadow:0 0 14px rgba(255,101,53,.3);}
.av.lead{background:var(--card2);border:1px solid var(--border2);}
.bdy{max-width:86%;}
.bsender{font-size:10px;color:var(--muted);margin-bottom:3px;}
.lr .bsender{text-align:right;}
.bubble{padding:9px 13px;border-radius:13px;font-size:13px;line-height:1.65;}
.ai-bub{background:linear-gradient(135deg,rgba(255,101,53,.1),rgba(232,54,155,.07));border:1px solid rgba(255,101,53,.18);border-radius:3px 13px 13px 13px;}
.lead-bub{background:var(--card2);border:1px solid var(--border2);border-radius:13px 3px 13px 13px;color:#c0c0d8;}
.sbadge{display:inline-flex;align-items:center;gap:4px;font-size:9px;font-weight:700;padding:2px 8px;border-radius:20px;margin-top:5px;text-transform:uppercase;letter-spacing:.5px;}
.s0{background:rgba(139,92,246,.15);color:#b09af8;border:1px solid rgba(139,92,246,.25);}
.s1{background:rgba(56,182,255,.15);color:var(--blue);border:1px solid rgba(56,182,255,.25);}
.s2{background:rgba(255,101,53,.15);color:var(--orange);border:1px solid rgba(255,101,53,.25);}
.s3{background:rgba(0,212,255,.15);color:#00d4ff;border:1px solid rgba(0,212,255,.25);}
.s4{background:rgba(232,54,155,.2);color:var(--pink);border:1px solid rgba(232,54,155,.3);}
.typing-row{display:flex;gap:9px;}
.tbub{padding:11px 14px;background:rgba(255,101,53,.07);border:1px solid rgba(255,101,53,.15);border-radius:3px 13px 13px 13px;display:flex;gap:4px;align-items:center;}
.td{width:6px;height:6px;border-radius:50%;background:var(--orange);animation:td 1.3s ease-in-out infinite;}
.td:nth-child(2){animation-delay:.2s;}.td:nth-child(3){animation-delay:.4s;}
@keyframes td{0%,60%,100%{transform:translateY(0);opacity:.4;}30%{transform:translateY(-5px);opacity:1;}}
.chat-bar{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:9px;align-items:flex-end;}
.chat-in{flex:1;background:var(--surface);border:1px solid var(--border2);border-radius:var(--rs);padding:9px 13px;color:var(--white);font-family:'Sora',sans-serif;font-size:13px;resize:none;outline:none;max-height:100px;transition:border-color .2s;}
.chat-in:focus{border-color:rgba(255,101,53,.4);}
.chat-in::placeholder{color:var(--muted);}
.send-b{width:40px;height:40px;border-radius:var(--rs);border:none;background:var(--grad);color:white;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.send-b:hover:not(:disabled){transform:scale(1.06);box-shadow:0 0 18px rgba(255,101,53,.4);}
.send-b:disabled{opacity:.4;cursor:not-allowed;}

/* LEAD CARD */
.lead-panel{display:flex;flex-direction:column;gap:14px;}
.lead-info{padding:16px;}
.lead-ava{width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--blue));display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 16px rgba(139,92,246,.3);margin-bottom:11px;}
.lead-name{font-size:16px;font-weight:700;}
.lead-sub{font-size:11px;color:var(--muted2);margin-top:2px;margin-bottom:12px;}
.score-row{display:flex;justify-content:space-between;font-size:11px;margin-bottom:5px;}
.score-track{height:5px;background:var(--border);border-radius:3px;}
.score-fill{height:100%;border-radius:3px;background:var(--grad);box-shadow:0 0 8px rgba(255,101,53,.3);transition:width 1s cubic-bezier(.34,1.56,.64,1);}
.tags{display:flex;flex-wrap:wrap;gap:5px;margin:10px 0 12px;}
.tag{font-size:10px;padding:3px 8px;border-radius:20px;border:1px solid var(--border2);color:var(--muted2);}
.ac-row{display:grid;grid-template-columns:1fr 1fr;gap:7px;}

/* JORNADA */
.jtrack{padding:14px 16px;display:flex;flex-direction:column;gap:4px;}
.jstep{display:flex;align-items:center;gap:10px;padding:7px 0;}
.jdot{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;transition:all .3s;}
.jdot.done{background:rgba(0,230,118,.15);border:1px solid rgba(0,230,118,.3);color:var(--green);}
.jdot.now{background:var(--grad);box-shadow:0 0 12px rgba(255,101,53,.4);}
.jdot.todo{background:var(--surface);border:1px solid var(--border2);color:var(--muted);}
.ji-l{font-size:12px;font-weight:600;}

/* TABLE */
table{width:100%;border-collapse:collapse;}
th{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;text-align:left;padding:9px 12px;border-bottom:1px solid var(--border);}
td{padding:10px 12px;border-bottom:1px solid rgba(26,26,42,.6);font-size:13px;vertical-align:middle;}
tr:hover td{background:rgba(255,101,53,.025);}
.tname{font-weight:600;}.tsub{font-size:10px;color:var(--muted);margin-top:1px;}
.temp{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;}
.t-hot{background:rgba(239,68,68,.12);color:#f87171;border:1px solid rgba(239,68,68,.25);}
.t-warm{background:rgba(255,101,53,.12);color:var(--orange);border:1px solid rgba(255,101,53,.25);}
.t-cold{background:rgba(56,182,255,.12);color:var(--blue);border:1px solid rgba(56,182,255,.25);}
.pmini{display:inline-block;width:48px;height:4px;background:var(--border);border-radius:2px;vertical-align:middle;}
.pfill{height:100%;border-radius:2px;background:var(--grad);}

/* FUNIL */
.funnel-bar{display:flex;align-items:center;gap:12px;padding:9px 12px;background:var(--surface);border-radius:var(--rs);margin-bottom:6px;}
.fb-label{font-size:12px;font-weight:600;width:110px;flex-shrink:0;}
.fb-track{flex:1;height:6px;background:var(--border);border-radius:3px;}
.fb-fill{height:100%;border-radius:3px;background:var(--grad);}
.fb-count{font-family:'Bebas Neue';font-size:20px;color:var(--orange);width:40px;text-align:right;}

/* TRAINING */
.train-form{padding:20px;display:flex;flex-direction:column;gap:16px;}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
select.fi option{background:var(--card);}
textarea.fi{resize:vertical;min-height:80px;line-height:1.6;}

/* ZAPI SETUP */
.zapi-hero{background:linear-gradient(135deg,rgba(0,230,118,.08),rgba(0,230,118,.03));border:1px solid rgba(0,230,118,.15);border-radius:var(--r);padding:20px;margin-bottom:20px;display:flex;align-items:center;gap:16px;}
.setup-steps{display:flex;flex-direction:column;gap:10px;}
.setup-step{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:15px 18px;display:flex;align-items:center;gap:14px;}
.snum{width:28px;height:28px;border-radius:50%;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0;}
.si{flex:1;}.si-t{font-size:13px;font-weight:600;}.si-d{font-size:11px;color:var(--muted);margin-top:2px;}

/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(12px);z-index:300;display:none;align-items:center;justify-content:center;padding:20px;}
.modal-bg.open{display:flex;}
.modal{background:var(--card);border:1px solid var(--border2);border-radius:18px;width:100%;max-width:480px;padding:28px;animation:mIn .3s cubic-bezier(.34,1.56,.64,1);max-height:90vh;overflow-y:auto;}
@keyframes mIn{from{opacity:0;transform:scale(.92) translateY(20px);}to{opacity:1;transform:none;}}
.m-title{font-size:18px;font-weight:700;margin-bottom:5px;}
.m-desc{color:var(--muted);font-size:12px;margin-bottom:20px;line-height:1.6;}
.m-btns{display:flex;gap:9px;justify-content:flex-end;margin-top:20px;}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;z-index:400;background:var(--card2);border:1px solid var(--border2);border-radius:var(--r);padding:12px 18px;display:flex;align-items:center;gap:9px;font-size:13px;box-shadow:0 8px 40px rgba(0,0,0,.5);transform:translateY(70px);opacity:0;transition:all .4s cubic-bezier(.34,1.56,.64,1);pointer-events:none;}
.toast.show{transform:translateY(0);opacity:1;}

/* CONFIRM MODAL */
.confirm-bg{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);z-index:350;display:none;align-items:center;justify-content:center;padding:20px;}
.confirm-bg.open{display:flex;}
.confirm-box{background:var(--card);border:1px solid rgba(255,71,87,.3);border-radius:16px;width:100%;max-width:360px;padding:24px;animation:mIn .3s ease;}

/* MISC */
.gt{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.sec-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;}
.sec-title{font-size:16px;font-weight:700;}
.info-row{display:flex;justify-content:space-between;padding:9px 12px;background:var(--surface);border-radius:var(--rs);font-size:12px;}
.info-row span:first-child{color:var(--muted);}
.info-row span:last-child{font-weight:600;}

@media(max-width:768px){
  .master-stats{grid-template-columns:repeat(2,1fr);}
  .stats-row{grid-template-columns:repeat(2,1fr);}
  .chat-wrap{grid-template-columns:1fr;}
  .sidebar{transform:translateX(-100%);transition:transform .3s;}
  .sidebar.mob-open{transform:translateX(0);}
  .main-panel{margin-left:0;}
}
::-webkit-scrollbar{width:3px;}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
</style>
</head>
<body>
<div class="aurora"><div class="ab ab1"></div><div class="ab ab2"></div><div class="ab ab3"></div></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 1 ‚Äî LOGIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="screen-login">
  <div class="login-box">
    <div class="login-logo">
      <div class="ll-mark">PULSAR</div>
      <div class="ll-sub">SDR AI Platform</div>
    </div>
    <div class="login-tabs">
      <div class="ltab active" onclick="setLoginTab('agency',this)">üè¢ Ag√™ncia</div>
      <div class="ltab" onclick="setLoginTab('client',this)">üè™ Cliente</div>
    </div>

    <!-- AGENCY FORM -->
    <div id="login-agency-form">
      <div class="ff">
        <label class="fl">E-mail da Ag√™ncia</label>
        <input class="fi" type="email" id="ag-email" placeholder="agencia@pulsar.com" autocomplete="email"/>
      </div>
      <div class="ff">
        <label class="fl">Senha</label>
        <div class="pw-wrap">
          <input class="fi" type="password" id="ag-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
          <button class="pw-toggle" type="button" onclick="togglePw('ag-pass',this)">üëÅ</button>
        </div>
      </div>
      <button class="btn btn-fire" style="width:100%;margin-top:4px;" onclick="loginAgency()">Entrar como Ag√™ncia ‚Üí</button>
      <div class="login-err" id="ag-err">E-mail ou senha incorretos.</div>
    </div>

    <!-- CLIENT FORM -->
    <div id="login-client-form" style="display:none;">
      <div class="ff">
        <label class="fl">E-mail</label>
        <input class="fi" type="email" id="cl-email" placeholder="cliente@empresa.com" autocomplete="email"/>
      </div>
      <div class="ff">
        <label class="fl">Senha</label>
        <div class="pw-wrap">
          <input class="fi" type="password" id="cl-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
          <button class="pw-toggle" type="button" onclick="togglePw('cl-pass',this)">üëÅ</button>
        </div>
      </div>
      <button class="btn btn-fire" style="width:100%;margin-top:4px;" onclick="loginClient()">Entrar ‚Üí</button>
      <div class="login-err" id="cl-err">E-mail ou senha incorretos.</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 2 ‚Äî AGENCY MASTER PANEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-agency" style="flex-direction:column;">
  <div class="agency-topbar">
    <div style="display:flex;align-items:center;">
      <div class="agency-logo">PULSAR SDR</div>
      <span class="agency-badge">AG√äNCIA MASTER</span>
    </div>
    <div style="display:flex;gap:9px;align-items:center;">
      <span style="font-size:12px;color:var(--muted2);" id="agency-name-display">Pulsar Marketing 360</span>
      <button class="btn btn-fire btn-sm" onclick="addClientModal()">+ Novo Cliente</button>
      <button class="btn btn-ghost btn-sm" onclick="logout()">Sair</button>
    </div>
  </div>

  <div class="agency-content">
    <!-- STATS -->
    <div class="master-stats">
      <div class="ms"><div class="ms-val" id="stat-clientes">0</div><div class="ms-lbl">Clientes Ativos</div><div class="ms-sub" id="stat-clientes-sub">Nenhum ainda</div></div>
      <div class="ms"><div class="ms-val" id="stat-leads">0</div><div class="ms-lbl">Leads Totais</div><div class="ms-sub">Gerados pelo agente</div></div>
      <div class="ms"><div class="ms-val" id="stat-hot">0</div><div class="ms-lbl">Leads Quentes</div><div class="ms-sub">Prontos p/ fechar</div></div>
      <div class="ms"><div class="ms-val" id="stat-mrr">R$0</div><div class="ms-lbl">MRR Mensalidades</div><div class="ms-sub" id="stat-mrr-sub">‚Üë Crescendo</div></div>
      <div class="ms"><div class="ms-val">94%</div><div class="ms-lbl">Engajamento IA</div><div class="ms-sub">24/7 dispon√≠vel</div></div>
    </div>

    <!-- CLIENTS -->
    <div class="sec-hdr">
      <div class="sec-title">üè™ Clientes</div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-fire btn-sm" onclick="addClientModal()">+ Adicionar Cliente</button>
      </div>
    </div>
    <div class="clients-grid" id="clientsGrid"></div>

    <!-- API + COST -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:8px;">
      <!-- API KEY -->
      <div class="panel">
        <div class="ph">
          <div class="ph-t">üîë API Key Anthropic ‚Äî Centralizada</div>
          <span id="apiStatusBadge" style="font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(255,71,87,.12);color:var(--red);border:1px solid rgba(255,71,87,.2);">N√£o configurada</span>
        </div>
        <div style="padding:18px;">
          <div style="font-size:12px;color:var(--muted2);line-height:1.65;margin-bottom:14px;background:rgba(56,182,255,.05);border:1px solid rgba(56,182,255,.1);border-radius:var(--rs);padding:11px 14px;">
            üí° <strong style="color:var(--white);">Esta chave √© usada por todos os seus clientes.</strong> Os clientes nunca t√™m acesso a ela.
          </div>
          <div class="ff">
            <label class="fl">Chave da API</label>
            <div style="display:flex;gap:8px;">
              <input class="fi" type="password" id="agencyApiKey" placeholder="sk-ant-api03-..." style="flex:1;" oninput="checkApiKey(this.value)"/>
              <button class="btn btn-ghost btn-sm" onclick="toggleApiKeyVisibility()">üëÅ</button>
            </div>
          </div>
          <div class="ff">
            <label class="fl">Modelo IA</label>
            <select class="fi" id="agencyModel">
              <option value="claude-sonnet-4-20250514">claude-sonnet-4 ‚Äî Melhor qualidade ‚úÖ</option>
              <option value="claude-haiku-4-5-20251001">claude-haiku-4-5 ‚Äî Mais econ√¥mico</option>
            </select>
          </div>
          <button class="btn btn-fire" style="width:100%;justify-content:center;" onclick="saveAgencyApiKey()">üîë Salvar e Ativar</button>
          <div style="font-size:11px;color:var(--muted);margin-top:10px;text-align:center;">Obtenha sua chave em <a href="https://console.anthropic.com" target="_blank" style="color:var(--blue);">console.anthropic.com</a></div>
        </div>
      </div>

      <!-- CUSTO -->
      <div class="panel">
        <div class="ph"><div class="ph-t">üìä Estimativa de Receita</div></div>
        <div style="padding:18px;display:flex;flex-direction:column;gap:8px;">
          <div class="info-row"><span>Clientes ativos</span><span id="activeClientsCount">0</span></div>
          <div class="info-row"><span>Custo IA estimado/m√™s</span><span style="color:var(--orange);" id="ia-cost">R$0</span></div>
          <div class="info-row"><span>Custo operacional (Zapi+Railway)</span><span style="color:var(--orange);">~R$150</span></div>
          <div class="info-row"><span>Mensalidades dos clientes</span><span style="color:var(--green);" id="mrrDisplay">R$0</span></div>
          <div style="display:flex;justify-content:space-between;padding:11px 12px;background:linear-gradient(90deg,rgba(0,230,118,.06),transparent);border:1px solid rgba(0,230,118,.1);border-radius:var(--rs);">
            <span style="font-size:12px;color:var(--green);">Margem l√≠quida estimada</span>
            <span style="font-weight:700;font-size:15px;color:var(--green);" id="margem-display">R$0</span>
          </div>
          <div style="font-size:11px;color:var(--muted);line-height:1.6;margin-top:4px;">~R$0,003‚Äì0,01 por mensagem com claude-sonnet-4. 500 conversas/cliente ‚âà R$20‚Äì30/m√™s.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN 3 ‚Äî CLIENT PANEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-client">
  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sb-logo">
      <div class="sb-brand">PULSAR SDR</div>
      <div class="sb-client" id="sb-client-name">‚Äî</div>
      <div class="ai-live"><div class="pring"></div>IA ATIVA 24/7</div>
    </div>
    <div class="sb-nav">
      <button class="nb active" onclick="showView('dash',this)"><span class="ni">üìä</span>Dashboard</button>
      <button class="nb" onclick="showView('agente',this)"><span class="ni">ü§ñ</span>Agente SDR<span class="npill" id="leads-count">0</span></button>
      <button class="nb" onclick="showView('leads',this)"><span class="ni">üë•</span>Todos os Leads</button>
      <button class="nb" onclick="showView('funil',this)"><span class="ni">üîª</span>Funil de Vendas</button>
      <button class="nb" onclick="showView('treinamento',this)"><span class="ni">üß†</span>Treinamento</button>
      <button class="nb" onclick="showView('whatsapp',this)"><span class="ni">üì±</span>WhatsApp (Zapi)</button>
      <button class="nb" onclick="showView('config',this)"><span class="ni">‚öôÔ∏è</span>Configura√ß√µes</button>
    </div>
    <div class="sb-foot">
      <div style="font-size:11px;color:var(--muted2);margin-bottom:8px;">Pulsar Marketing 360</div>
      <button class="btn btn-ghost btn-sm" style="width:100%" onclick="backToAgency()">‚Üê Voltar ao Painel</button>
    </div>
  </div>

  <!-- MAIN PANEL -->
  <div class="main-panel">
    <div class="topbar">
      <div class="topbar-title" id="pageTitle">Dashboard</div>
      <div class="topbar-right">
        <span id="score-display" style="font-size:12px;color:var(--muted2);">Score: ‚Äî</span>
        <button class="btn btn-ghost btn-sm" onclick="resetChat()">üîÑ Novo Lead</button>
        <button class="btn btn-ghost btn-sm" onclick="logout()">Sair</button>
      </div>
    </div>

    <div class="content">

      <!-- DASHBOARD VIEW -->
      <div class="view active" id="view-dash">
        <div class="stats-row">
          <div class="stat"><div class="stat-lbl">Leads Totais</div><div class="stat-num" id="d-leads">0</div><div class="stat-sub">Gerados pelo agente</div></div>
          <div class="stat"><div class="stat-lbl">Leads Quentes</div><div class="stat-num" id="d-hot">0</div><div class="stat-sub">Prontos p/ fechar</div></div>
          <div class="stat"><div class="stat-lbl">Fechamentos</div><div class="stat-num" id="d-conv">0</div><div class="stat-sub">Este m√™s</div></div>
          <div class="stat"><div class="stat-lbl">Score M√©dio</div><div class="stat-num" id="d-score">‚Äî</div><div class="stat-sub">Da carteira atual</div></div>
        </div>
        <div class="panel">
          <div class="ph"><div class="ph-t">üî• Leads Quentes Recentes</div><button class="btn btn-green btn-xs" onclick="exportHot()">üì± Enviar ao Vendedor</button></div>
          <div style="overflow-x:auto;"><table><thead><tr><th>Lead</th><th>Temperatura</th><th>Score</th><th>Etapa</th><th>A√ß√£o</th></tr></thead><tbody id="hotTbl"></tbody></table></div>
        </div>
      </div>

      <!-- AGENTE VIEW -->
      <div class="view" id="view-agente">
        <div class="sec-hdr">
          <div><div class="sec-title">ü§ñ Agente SDR ‚Äî Demo ao Vivo</div><div style="font-size:11px;color:var(--muted);margin-top:2px;">Simule uma conversa como se fosse um lead do WhatsApp</div></div>
          <div style="display:flex;gap:8px;align-items:center;">
            <select class="fi" id="nichoSel2" onchange="resetChat()" style="width:160px;font-size:12px;">
              <option value="clinica">üè• Cl√≠nica</option>
              <option value="restaurante">üçï Restaurante</option>
              <option value="academia">üí™ Academia</option>
              <option value="advocacia">‚öñÔ∏è Advocacia</option>
              <option value="imoveis">üè† Im√≥veis</option>
              <option value="salao">üíá Sal√£o</option>
            </select>
          </div>
        </div>
        <div class="chat-wrap">
          <div class="panel chat-panel">
            <div class="ph"><div class="ph-t">üí¨ Conversa ‚Äî WhatsApp Simulado</div></div>
            <div class="chat-win" id="chatWin2"></div>
            <div class="chat-bar">
              <textarea class="chat-in" id="chatIn2" placeholder="Simule uma mensagem de lead..." rows="1" onkeydown="hk(event,'chatIn2','send2')"></textarea>
              <button class="send-b" id="send2" onclick="sendMsg('chatIn2','chatWin2','send2')">‚û§</button>
            </div>
          </div>
          <div class="lead-panel">
            <div class="panel"><div class="ph"><div class="ph-t">üéØ Lead Scoring</div></div>
              <div class="lead-info">
                <div class="lead-ava" id="leadAva">üë§</div>
                <div class="lead-name" id="leadName">Aguardando...</div>
                <div class="lead-sub" id="leadSub">Inicie uma conversa</div>
                <div class="score-row"><span style="font-size:11px;color:var(--muted);">Score de qualifica√ß√£o</span><span style="font-weight:700;color:var(--orange);" id="sc2">0%</span></div>
                <div class="score-track"><div class="score-fill" id="scoreFill" style="width:0%"></div></div>
                <div class="tags" id="leadTags"><span class="tag">üí¨ Aguardando</span></div>
                <div class="ac-row">
                  <div style="background:var(--surface);border-radius:var(--rs);padding:8px;"><div style="font-size:9px;color:var(--muted);margin-bottom:3px;">TEMPERATURA</div><div id="tp2" style="font-size:12px;font-weight:700;">‚Äî</div></div>
                  <div style="background:var(--surface);border-radius:var(--rs);padding:8px;"><div style="font-size:9px;color:var(--muted);margin-bottom:3px;">INTEN√á√ÉO</div><div id="in2" style="font-size:12px;font-weight:700;">‚Äî</div></div>
                </div>
              </div>
            </div>
            <div class="panel"><div class="ph"><div class="ph-t">üó∫Ô∏è Jornada</div></div>
              <div class="jtrack" id="jtrack2">
                <div class="jstep"><div class="jdot todo">üîç</div><div class="ji"><div class="ji-l">Consci√™ncia</div></div></div>
                <div class="jstep"><div class="jdot todo">üí°</div><div class="ji"><div class="ji-l">Interesse</div></div></div>
                <div class="jstep"><div class="jdot todo">‚öñÔ∏è</div><div class="ji"><div class="ji-l">Considera√ß√£o</div></div></div>
                <div class="jstep"><div class="jdot todo">üéØ</div><div class="ji"><div class="ji-l">Decis√£o</div></div></div>
                <div class="jstep"><div class="jdot todo">ü§ù</div><div class="ji"><div class="ji-l">Lead Quente</div></div></div>
              </div>
            </div>
            <button class="btn btn-green" id="waBtn2" onclick="openWA()" disabled style="width:100%;justify-content:center;">üì± Enviar ao Vendedor</button>
          </div>
        </div>
      </div>

      <!-- LEADS VIEW -->
      <div class="view" id="view-leads">
        <div class="sec-hdr">
          <div><div class="sec-title">üë• Todos os Leads</div></div>
          <button class="btn btn-fire btn-sm" onclick="exportHot()">üî• Exportar Quentes</button>
        </div>
        <div class="panel"><div style="overflow-x:auto;"><table><thead><tr><th>Lead</th><th>Temp</th><th>Score</th><th>Etapa</th><th>Data</th><th>A√ß√£o</th></tr></thead><tbody id="allTbl"></tbody></table></div></div>
      </div>

      <!-- FUNIL VIEW -->
      <div class="view" id="view-funil">
        <div class="sec-title" style="margin-bottom:20px;">üîª Funil de Vendas</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div class="panel">
            <div class="ph"><div class="ph-t">Convers√£o por Etapa</div></div>
            <div style="padding:16px;">
              <div class="funnel-bar"><div class="fb-label">üì¢ Consci√™ncia</div><div class="fb-track"><div class="fb-fill" style="width:100%"></div></div><div class="fb-count">312</div></div>
              <div class="funnel-bar"><div class="fb-label">üí° Interesse</div><div class="fb-track"><div class="fb-fill" style="width:74%"></div></div><div class="fb-count">231</div></div>
              <div class="funnel-bar"><div class="fb-label">‚öñÔ∏è Considera√ß√£o</div><div class="fb-track"><div class="fb-fill" style="width:51%"></div></div><div class="fb-count">159</div></div>
              <div class="funnel-bar"><div class="fb-label">üéØ Decis√£o</div><div class="fb-track"><div class="fb-fill" style="width:30%"></div></div><div class="fb-count">94</div></div>
              <div class="funnel-bar" style="background:rgba(255,101,53,.05);border:1px solid rgba(255,101,53,.1);border-radius:var(--rs);"><div class="fb-label" style="color:var(--orange);">üî• Quente</div><div class="fb-track"><div class="fb-fill" style="width:15%"></div></div><div class="fb-count">47</div></div>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:14px;">
            <div class="panel">
              <div class="ph"><div class="ph-t">‚ö° Performance</div></div>
              <div style="padding:14px;display:flex;flex-direction:column;gap:8px;">
                <div class="info-row"><span>Resposta m√©dia</span><span style="color:var(--blue);">3.2s</span></div>
                <div class="info-row"><span>Taxa engajamento</span><span style="color:var(--green);">94%</span></div>
                <div class="info-row"><span>Leads/dia</span><span style="color:var(--orange);">28</span></div>
                <div class="info-row"><span>Uptime IA</span><span style="color:var(--green);">100%</span></div>
              </div>
            </div>
            <div class="panel">
              <div class="ph"><div class="ph-t">üí∞ ROI do Cliente</div></div>
              <div style="padding:16px;text-align:center;">
                <div style="font-size:11px;color:var(--muted);margin-bottom:8px;">Receita gerada via SDR</div>
                <div style="font-family:'Bebas Neue';font-size:44px;" class="gt">R$22.400</div>
                <div style="font-size:12px;color:var(--muted);margin-top:4px;">vs R$1.299/m√™s investido</div>
                <div style="font-size:14px;color:var(--green);font-weight:700;margin-top:8px;">ROI: 1.623% üöÄ</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TREINAMENTO VIEW -->
      <div class="view" id="view-treinamento">
        <div class="sec-hdr"><div class="sec-title">üß† Treinamento do Agente IA</div><button class="btn btn-fire btn-sm" onclick="showToast('üíæ Agente atualizado!')">üíæ Salvar</button></div>
        <div class="panel">
          <div class="ph"><div class="ph-t">‚öôÔ∏è Configura√ß√£o do Agente</div></div>
          <div class="train-form">
            <div class="ff"><label class="fl">Nome do Neg√≥cio</label><input class="fi" id="t-negocio" value="Cl√≠nica Bella Est√©tica"/></div>
            <div class="ff"><label class="fl">Persona do Agente</label><input class="fi" id="t-persona" value="Sofia ‚Äî Consultora especialista em est√©tica"/></div>
            <div class="ff"><label class="fl">Servi√ßos / Produtos</label><textarea class="fi" id="t-servicos">Botox, Preenchimento labial, Limpeza de pele, Tratamento para manchas</textarea></div>
            <div class="ff"><label class="fl">Principais Obje√ß√µes e Como Contornar</label><textarea class="fi" id="t-objecoes">Pre√ßo alto ‚Üí Parcelamento e ROI emocional (autoestima, confian√ßa)
"Vou pensar" ‚Üí Vagas limitadas, promo√ß√£o por tempo limitado
Medo ‚Üí Protocolos de conforto, depoimentos reais</textarea></div>
            <div class="ff"><label class="fl">Perguntas de Qualifica√ß√£o</label><textarea class="fi" id="t-perguntas">Qual √© seu principal objetivo com o tratamento?
Voc√™ j√° fez algum procedimento est√©tico antes?
Tem alguma data especial se aproximando?</textarea></div>
            <div class="row2">
              <div class="ff"><label class="fl">CTA Principal</label><input class="fi" id="t-cta" value="Agendar avalia√ß√£o gratuita"/></div>
              <div class="ff"><label class="fl">Tom de Comunica√ß√£o</label><select class="fi" id="t-tom"><option>Amig√°vel e Emp√°tico</option><option>Profissional e Formal</option><option>Descontra√≠do e Jovial</option></select></div>
            </div>
            <button class="btn btn-fire" style="width:100%;justify-content:center;" onclick="showToast('ü§ñ Agente atualizado com sucesso!')">üöÄ Salvar e Aplicar Mudan√ßas</button>
          </div>
        </div>
      </div>

      <!-- WHATSAPP VIEW ‚Äî ZAPI -->
      <div class="view" id="view-whatsapp">
        <div class="sec-title" style="margin-bottom:20px;">üì± Integra√ß√£o WhatsApp via Zapi</div>

        <div class="zapi-hero">
          <span style="font-size:36px;">‚ö°</span>
          <div style="flex:1;">
            <div style="font-size:15px;font-weight:700;color:var(--green);">Zapi ‚Äî WhatsApp API Conectado</div>
            <div style="font-size:12px;color:var(--muted);margin-top:4px;">Agente recebendo e respondendo mensagens automaticamente via Zapi + n8n Cloud.</div>
          </div>
          <span style="font-size:11px;color:var(--green);font-weight:700;">‚óè Ativo</span>
        </div>

        <div style="font-size:14px;font-weight:700;margin-bottom:14px;">üìã Credenciais Zapi desta inst√¢ncia</div>
        <div class="setup-steps" style="margin-bottom:24px;">
          <div class="setup-step">
            <div class="snum">1</div>
            <div class="si"><div class="si-t">Instance ID</div><div class="si-d">Encontrado na p√°gina da inst√¢ncia em app.z-api.io</div></div>
            <input class="fi" id="zapi-instance" placeholder="3EF369ABFE5C321E9910DE26C08F8D63" style="width:260px;font-size:11px;font-family:monospace;"/>
          </div>
          <div class="setup-step">
            <div class="snum">2</div>
            <div class="si"><div class="si-t">Token</div><div class="si-d">Token principal da inst√¢ncia</div></div>
            <input class="fi" id="zapi-token" placeholder="D8FD069AD1E30FDE0B7624DB" style="width:260px;font-size:11px;font-family:monospace;"/>
          </div>
          <div class="setup-step" style="border-color:rgba(255,101,53,.2);">
            <div class="snum">3</div>
            <div class="si"><div class="si-t">Client-Token <span style="color:var(--orange);font-size:10px;">(obrigat√≥rio)</span></div><div class="si-d">Aba Security dentro da inst√¢ncia no Zapi</div></div>
            <input class="fi" id="zapi-client-token" placeholder="Fxxxxxxxxxxxxxxxxx" style="width:260px;font-size:11px;font-family:monospace;"/>
          </div>
          <div class="setup-step">
            <div class="snum">4</div>
            <div class="si"><div class="si-t">URL do Webhook n8n</div><div class="si-d">Cole esta URL no campo "On Message Received" no painel Zapi</div></div>
            <div style="display:flex;gap:8px;align-items:center;">
              <input class="fi" id="n8n-webhook-url" placeholder="https://usuario.app.n8n.cloud/webhook/zapi" style="width:280px;font-size:11px;"/>
              <button class="btn btn-ghost btn-xs" onclick="copyField('n8n-webhook-url')">Copiar</button>
            </div>
          </div>
        </div>
        <button class="btn btn-fire" onclick="showToast('‚úÖ Configura√ß√µes Zapi salvas!')">üíæ Salvar Configura√ß√µes Zapi</button>

        <div style="margin-top:24px;background:rgba(56,182,255,.05);border:1px solid rgba(56,182,255,.1);border-radius:var(--r);padding:16px;">
          <div style="font-size:13px;font-weight:700;margin-bottom:10px;color:var(--blue);">üí° Fluxo de funcionamento</div>
          <div style="font-size:12px;color:var(--muted2);line-height:1.9;">
            Lead envia mensagem ‚Üí <strong style="color:var(--white);">Zapi captura</strong> ‚Üí envia para n8n via webhook ‚Üí <strong style="color:var(--white);">n8n monta o contexto</strong> ‚Üí chama <strong style="color:var(--white);">Claude AI</strong> ‚Üí resposta volta para o Zapi ‚Üí <strong style="color:var(--white);">mensagem enviada ao lead</strong> em segundos.<br><br>
            ‚ö†Ô∏è <strong style="color:var(--yellow);">O workflow do n8n deve estar ativo (toggle verde)</strong> para o agente responder. Verifique sempre que fizer altera√ß√µes nos n√≥s.
          </div>
        </div>
      </div>

      <!-- CONFIG VIEW -->
      <div class="view" id="view-config">
        <div class="sec-title" style="margin-bottom:6px;">‚öôÔ∏è Configura√ß√µes da Conta</div>
        <div style="max-width:520px;display:flex;flex-direction:column;gap:14px;">

          <div class="panel">
            <div class="ph"><div class="ph-t">ü§ñ Status da IA</div></div>
            <div style="padding:16px;">
              <div style="display:flex;align-items:center;gap:12px;background:rgba(0,230,118,.06);border:1px solid rgba(0,230,118,.15);border-radius:var(--rs);padding:12px 14px;margin-bottom:12px;">
                <div style="width:9px;height:9px;border-radius:50%;background:var(--green);box-shadow:0 0 8px rgba(0,230,118,.5);animation:dp 2s infinite;"></div>
                <div><div style="font-size:13px;font-weight:700;color:var(--green);">IA Ativa e Funcionando</div><div style="font-size:11px;color:var(--muted);margin-top:1px;">Gerenciada pela Pulsar Marketing 360 ¬∑ 24/7</div></div>
              </div>
              <div style="font-size:12px;color:var(--muted);line-height:1.7;">A intelig√™ncia artificial √© configurada e mantida pela sua ag√™ncia. Voc√™ n√£o precisa fazer nada.</div>
            </div>
          </div>

          <div class="panel">
            <div class="ph"><div class="ph-t">üì± WhatsApp para Leads Quentes</div></div>
            <div style="padding:16px;">
              <div style="font-size:12px;color:var(--muted2);margin-bottom:12px;line-height:1.6;">Quando um lead estiver qualificado com score alto, ele ser√° enviado para este n√∫mero.</div>
              <div class="ff"><label class="fl">N√∫mero do vendedor (com DDI)</label><input class="fi" id="waInp" placeholder="5511999999999"/></div>
              <button class="btn btn-fire btn-sm" onclick="saveClientWA()">üíæ Salvar n√∫mero</button>
            </div>
          </div>

          <div class="panel">
            <div class="ph"><div class="ph-t">üë§ Dados da Conta</div></div>
            <div style="padding:16px;">
              <div class="ff"><label class="fl">Nome do respons√°vel</label><input class="fi" id="cfg-nome" value=""/></div>
              <div class="ff"><label class="fl">E-mail</label><input class="fi" type="email" id="cfg-email" value=""/></div>
              <div class="ff"><label class="fl">Empresa</label><input class="fi" id="cfg-empresa" value=""/></div>
              <div class="ff">
                <label class="fl">Alterar senha</label>
                <div class="pw-wrap">
                  <input class="fi" type="password" id="cfg-nova-senha" placeholder="Nova senha (deixe em branco para n√£o alterar)" autocomplete="new-password"/>
                  <button class="pw-toggle" type="button" onclick="togglePw('cfg-nova-senha',this)">üëÅ</button>
                </div>
              </div>
              <button class="btn btn-ghost btn-sm" onclick="showToast('‚úÖ Dados atualizados!')">Salvar altera√ß√µes</button>
            </div>
          </div>

          <div class="panel">
            <div class="ph"><div class="ph-t">üÜò Suporte</div></div>
            <div style="padding:16px;">
              <div style="font-size:13px;color:var(--muted2);margin-bottom:12px;">Fale direto com a Pulsar Marketing 360.</div>
              <div style="display:flex;gap:9px;">
                <button class="btn btn-green btn-sm" onclick="openSupportWA()">üì± WhatsApp da Ag√™ncia</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- content -->
  </div><!-- main-panel -->
</div><!-- screen-client -->

<!-- ADD CLIENT MODAL -->
<div class="modal-bg" id="mainModal">
  <div class="modal">
    <div class="m-title" id="mTitle">Novo Cliente</div>
    <div class="m-desc" id="mDesc">Configure um novo agente SDR para um cliente da ag√™ncia.</div>
    <div id="mBody"></div>
    <div class="m-btns">
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-fire" id="mOk">Confirmar</button>
    </div>
  </div>
</div>

<!-- CONFIRM DELETE MODAL -->
<div class="confirm-bg" id="confirmModal">
  <div class="confirm-box">
    <div style="font-size:18px;font-weight:700;margin-bottom:8px;color:var(--red);">‚ö†Ô∏è Remover Cliente</div>
    <div style="font-size:13px;color:var(--muted2);margin-bottom:20px;" id="confirm-msg">Tem certeza?</div>
    <div style="display:flex;gap:9px;justify-content:flex-end;">
      <button class="btn btn-ghost btn-sm" onclick="closeConfirm()">Cancelar</button>
      <button class="btn btn-red btn-sm" id="confirm-ok">Remover</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"><span id="tMsg"></span></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTADO GLOBAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AGENCY_EMAIL = 'admin@pulsarmarketing.com';
const AGENCY_PASS  = 'Pulsar@2025';

const app = {
  apiKey: '',
  model: 'claude-sonnet-4-20250514',
  history: [],
  score: 0,
  stage: -1,
  msgCount: 0,
  waNumber: '',
  currentClient: null,
  isAgency: false,
};

// Clientes em localStorage para persist√™ncia entre sess√µes
function loadClients() {
  try {
    const saved = localStorage.getItem('pulsar_clients');
    if (saved) return JSON.parse(saved);
  } catch(e) {}
  return [
    {id:1,name:'Cl√≠nica Bella',nicho:'clinica',avatar:'üè•',nichoLabel:'üè• Cl√≠nica M√©dica',plan:'pro',planLabel:'PRO',planPrice:1299,status:'active',leads:312,hot:47,conv:24,score:78,email:'joao@clinicabella.com',pass:'cliente123'},
    {id:2,name:'Restaurante Sabor',nicho:'restaurante',avatar:'üçï',nichoLabel:'üçï Restaurante',plan:'basico',planLabel:'B√ÅSICO',planPrice:999,status:'active',leads:198,hot:29,conv:15,score:65,email:'pedro@sabor.com',pass:'cliente123'},
    {id:3,name:'Academia FitLife',nicho:'academia',avatar:'üí™',nichoLabel:'üí™ Academia',plan:'pro',planLabel:'PRO',planPrice:1299,status:'active',leads:255,hot:38,conv:19,score:71,email:'ana@fitlife.com',pass:'cliente123'},
  ];
}

function saveClients(list) {
  localStorage.setItem('pulsar_clients', JSON.stringify(list));
}

let clients = loadClients();

const leadsData = [
  {name:'Roberto Alves',biz:'Dono de neg√≥cio',temp:'hot',score:91,stage:'Pronto',date:'Hoje 14:23'},
  {name:'Mariana Costa',biz:'Prospect',temp:'hot',score:78,stage:'Decis√£o',date:'Hoje 13:10'},
  {name:'Claudia Mendes',biz:'Empres√°ria',temp:'warm',score:55,stage:'Considera√ß√£o',date:'Hoje 11:45'},
  {name:'Paulo Ferreira',biz:'Professor',temp:'warm',score:61,stage:'Interesse',date:'Ontem 09:00'},
  {name:'Felipe Santos',biz:'Aut√¥nomo',temp:'cold',score:28,stage:'Consci√™ncia',date:'Hoje 09:30'},
  {name:'Juliana Ramos',biz:'Designer',temp:'hot',score:88,stage:'Pronto',date:'Ontem 14:00'},
];

const nichoData = {
  clinica:{name:'Cl√≠nica M√©dica/Est√©tica',negocio:'Cl√≠nica Bella Est√©tica',persona:'Sofia, consultora de est√©tica',servicos:'Botox, Preenchimento labial, Limpeza de pele, Tratamento para manchas',cta:'Agendar avalia√ß√£o gratuita',tom:'emp√°tico e acolhedor',objecoes:'Pre√ßo‚Üíparcelamento+autoestima | Medo‚Üíseguran√ßa e depoimentos'},
  restaurante:{name:'Restaurante',negocio:'Restaurante do Chef',persona:'Lucas, consultor gastron√¥mico',servicos:'Almo√ßo executivo, Jantar √† la carte, Eventos corporativos',cta:'Confirmar uma reserva',tom:'caloroso e sofisticado',objecoes:'Pre√ßo‚Üíexperi√™ncia √∫nica | Dist√¢ncia‚Üívale a pena'},
  academia:{name:'Academia/Fitness',negocio:'Academia FitLife',persona:'Rafael, personal trainer',servicos:'Muscula√ß√£o, Personal training, Aulas coletivas, Nutri√ß√£o esportiva',cta:'Agendar aula experimental gratuita',tom:'motivador e energ√©tico',objecoes:'Tempo‚Üí30min por dia | Pre√ßo‚Üíinvestimento na sa√∫de | Vergonha‚Üíambiente acolhedor'},
  advocacia:{name:'Advocacia',negocio:'Escrit√≥rio Jur√≠dico',persona:'Dr. Andr√©, consultor jur√≠dico',servicos:'Direito trabalhista, Direito civil, Contratos, Direito do consumidor',cta:'Agendar consulta inicial gratuita',tom:'profissional e confiante',objecoes:'Custo‚Üíhonor√°rios s√≥ no ganho | Demora‚Üíprazos claros'},
  imoveis:{name:'Imobili√°ria',negocio:'Prime Im√≥veis',persona:'Ana, consultora imobili√°ria',servicos:'Compra, venda, aluguel residencial e comercial, financiamento',cta:'Agendar visita ao im√≥vel',tom:'consultivo e seguro',objecoes:'Indecis√£o‚Üímomento do mercado | Financiamento‚Üíparceiros com taxas especiais'},
  salao:{name:'Sal√£o de Beleza',negocio:'Studio Hair',persona:'Camila, consultora de beleza',servicos:'Corte, colora√ß√£o, escova, manicure, maquiagem, penteados',cta:'Agendar hor√°rio',tom:'descontra√≠do e criativo',objecoes:'Pre√ßo‚Üíqualidade e durabilidade | Hor√°rio‚Üíagenda flex√≠vel incluindo s√°bados'},
};

const fallbackMsgs = {
  clinica:['Ol√°! üòä Sou a Sofia, consultora da Cl√≠nica Bella. O que te trouxe at√© aqui hoje?','Entendo! Que tipo de tratamento voc√™ estava pensando?','√ìtimo! Temos √≥timas op√ß√µes para isso. J√° fez algum procedimento est√©tico antes?','Para te ajudar melhor ‚Äî voc√™ tem disponibilidade esta semana para uma avalia√ß√£o gratuita?','Perfeito! Vou verificar a agenda. Prefere manh√£ ou tarde?'],
  restaurante:['Ol√°! üòä Sou o Lucas do restaurante. Posso ajudar?','Que √≥timo! Qual seria a ocasi√£o ‚Äî almo√ßo de neg√≥cios, jantar especial?','Temos op√ß√µes incr√≠veis para isso! Quantas pessoas seriam?','Que data voc√™ tem em mente?','Maravilha! Vou verificar a disponibilidade para voc√™s.'],
  academia:['E a√≠! üí™ Sou o Rafael da FitLife. Qual √© seu objetivo?','Show! Voc√™ j√° treina atualmente ou est√° come√ßando do zero?','Sem problema! Temos turmas para todos os n√≠veis. Quer conhecer com uma aula gratuita?','√ìtimo! Qual per√≠odo voc√™ prefere ‚Äî manh√£, tarde ou noite?','Confirmado! Vou separar sua vaga para a aula experimental.'],
  advocacia:['Ol√°! Sou o Dr. Andr√©. Como posso te orientar?','Entendo. Pode me dar mais detalhes sobre a situa√ß√£o?','Vejo que pode ser um caso onde podemos ajudar muito. Temos experi√™ncia similar.','Que tal uma consulta inicial gratuita para analisarmos melhor?','Perfeito! Quando voc√™ tem disponibilidade?'],
  imoveis:['Ol√°! üòä Sou a Ana da Prime Im√≥veis. Voc√™ est√° buscando comprar, vender ou alugar?','√ìtimo! Qual regi√£o e faixa de valor voc√™ tem em mente?','Temos √≥timas op√ß√µes nesse perfil! Voc√™ j√° tem carta de cr√©dito ou vai financiar?','Quando podemos marcar uma visita? Posso verificar os im√≥veis dispon√≠veis.','Combinado! Qual √© o melhor hor√°rio para voc√™?'],
  salao:['Oi! ‚ú® Sou a Camila do Studio Hair. O que voc√™ quer arrasar hoje?','Amei a ideia! Tem alguma refer√™ncia de foto?','Perfeito! Nosso time √© especialista nisso. Quando quer vir?','Qual per√≠odo voc√™ prefere ‚Äî manh√£, tarde ou s√°bado?','Marcado! Vai ficar incr√≠vel üòç'],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGIN / AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setLoginTab(type, el) {
  document.querySelectorAll('.ltab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('login-agency-form').style.display = type==='agency'?'block':'none';
  document.getElementById('login-client-form').style.display = type==='client'?'block':'none';
  document.getElementById('ag-err').style.display='none';
  document.getElementById('cl-err').style.display='none';
}

function loginAgency() {
  const e = document.getElementById('ag-email').value.trim();
  const p = document.getElementById('ag-pass').value;
  const err = document.getElementById('ag-err');
  if (e === AGENCY_EMAIL && p === AGENCY_PASS) {
    app.isAgency = true;
    err.style.display = 'none';
    const savedKey = localStorage.getItem('pulsar_agency_apikey') || '';
    const savedModel = localStorage.getItem('pulsar_agency_model') || 'claude-sonnet-4-20250514';
    if (savedKey) { document.getElementById('agencyApiKey').value = savedKey; app.apiKey = savedKey; }
    if (savedModel) { document.getElementById('agencyModel').value = savedModel; app.model = savedModel; }
    updateApiStatusBadge(savedKey);
    clients = loadClients();
    renderClients();
    updateAgencyStats();
    showScreen('agency');
  } else {
    err.style.display = 'block';
  }
}

function loginClient() {
  const e = document.getElementById('cl-email').value.trim().toLowerCase();
  const p = document.getElementById('cl-pass').value;
  const err = document.getElementById('cl-err');
  clients = loadClients();
  const client = clients.find(c => c.email.toLowerCase() === e && c.pass === p);
  if (client) {
    err.style.display = 'none';
    app.isAgency = false;
    app.currentClient = client;
    app.apiKey = localStorage.getItem('pulsar_agency_apikey') || '';
    app.model = localStorage.getItem('pulsar_agency_model') || 'claude-sonnet-4-20250514';
    loadClientPanel(client);
    showScreen('client');
  } else {
    err.style.display = 'block';
  }
}

function loadClientPanel(client) {
  document.getElementById('sb-client-name').textContent = client.name;
  document.getElementById('d-leads').textContent = client.leads;
  document.getElementById('d-hot').textContent = client.hot;
  document.getElementById('d-conv').textContent = client.conv;
  document.getElementById('d-score').textContent = client.score + '%';
  document.getElementById('leads-count').textContent = client.hot;
  document.getElementById('cfg-email').value = client.email;
  document.getElementById('cfg-empresa').value = client.name;
  renderHotTable();
  renderAllTable();
  setTimeout(() => resetChat(), 200);
}

function backToAgency() {
  if (app.isAgency) {
    clients = loadClients();
    renderClients();
    updateAgencyStats();
    showScreen('agency');
  } else {
    logout();
  }
}

function logout() { showScreen('login'); resetChat(); app.currentClient = null; app.isAgency = false; }

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + id).classList.add('active');
}

function togglePw(id, btn) {
  const inp = document.getElementById(id);
  if (!inp) return;
  inp.type = inp.type === 'password' ? 'text' : 'password';
  btn.textContent = inp.type === 'password' ? 'üëÅ' : 'üôà';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AGENCY PANEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderClients() {
  const grid = document.getElementById('clientsGrid');
  const colors = ['#ff6535','#38b6ff','#00e676','#e8369b','#8b5cf6','#ffd32a','#00d4ff'];
  const planCls = {basico:'plan-basico',pro:'plan-pro',premium:'plan-premium'};
  const statusCls = {active:'pill-active',trial:'pill-trial',paused:'pill-paused'};
  const statusLabel = {active:'‚óè Ativo',trial:'‚óè Trial',paused:'‚óè Pausado'};

  grid.innerHTML = clients.map((c, i) => `
    <div class="client-card">
      <div class="cc-top">
        <div class="cc-avatar" style="background:${colors[i%colors.length]}22;border:1px solid ${colors[i%colors.length]}44;">${c.avatar}</div>
        <div class="cc-info">
          <div class="cc-name">${c.name}</div>
          <div class="cc-nicho">${c.nichoLabel}</div>
          <div class="cc-email">üìß ${c.email}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
          <span class="pill ${statusCls[c.status]}">${statusLabel[c.status]}</span>
          <span class="plan-badge ${planCls[c.plan]}">${c.planLabel}</span>
        </div>
      </div>
      <div class="cc-metrics">
        <div class="ccm"><div class="ccm-val">${c.leads}</div><div class="ccm-lbl">Leads</div></div>
        <div class="ccm"><div class="ccm-val" style="color:var(--pink);">${c.hot}</div><div class="ccm-lbl">Quentes</div></div>
        <div class="ccm"><div class="ccm-val" style="color:var(--green);">${c.conv}</div><div class="ccm-lbl">Fechados</div></div>
      </div>
      <div class="cc-bar"><div class="cc-bar-fill" style="width:${c.score}%"></div></div>
      <div class="cc-actions">
        <button class="btn btn-ghost btn-xs" onclick="openClientAsAgency(${c.id})">üìä Painel</button>
        <button class="btn btn-ghost btn-xs" onclick="editClientModal(${c.id})">‚úèÔ∏è Editar</button>
        <button class="btn btn-red btn-xs" onclick="confirmDelete(${c.id},'${c.name.replace(/'/g,"\\'")}')">üóëÔ∏è Remover</button>
      </div>
    </div>
  `).join('') + `
    <div class="add-client-card" onclick="addClientModal()">
      <span style="font-size:32px;">‚ûï</span>
      <div style="font-size:14px;font-weight:600;">Adicionar Cliente</div>
      <div style="font-size:11px;text-align:center;max-width:180px;line-height:1.5;">Configure um novo agente SDR em minutos</div>
    </div>
  `;
}

function updateAgencyStats() {
  const active = clients.filter(c => c.status === 'active');
  const mrr = active.reduce((s, c) => s + (c.planPrice || 0), 0);
  const leads = clients.reduce((s, c) => s + (c.leads || 0), 0);
  const hot = clients.reduce((s, c) => s + (c.hot || 0), 0);
  const iaCost = Math.round(active.length * 25);
  const margem = mrr - iaCost - 150;

  document.getElementById('stat-clientes').textContent = active.length;
  document.getElementById('stat-clientes-sub').textContent = active.length > 0 ? `‚Üë +${active.length} ativo(s)` : 'Nenhum ainda';
  document.getElementById('stat-leads').textContent = leads.toLocaleString('pt-BR');
  document.getElementById('stat-hot').textContent = hot;
  document.getElementById('stat-mrr').textContent = 'R$' + mrr.toLocaleString('pt-BR');
  document.getElementById('activeClientsCount').textContent = active.length;
  document.getElementById('ia-cost').textContent = '~R$' + iaCost;
  document.getElementById('mrrDisplay').textContent = 'R$' + mrr.toLocaleString('pt-BR');
  document.getElementById('margem-display').textContent = 'R$' + Math.max(margem, 0).toLocaleString('pt-BR');
}

function openClientAsAgency(id) {
  const client = clients.find(c => c.id === id);
  if (!client) return;
  app.currentClient = client;
  app.isAgency = true;
  loadClientPanel(client);
  showScreen('client');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADD / EDIT CLIENT MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function clientFormHTML(c) {
  const planOptions = [
    {v:'basico',l:'B√°sico ‚Äî R$999/m√™s'},
    {v:'pro',l:'Pro ‚Äî R$1.299/m√™s'},
    {v:'premium',l:'Premium ‚Äî R$1.499/m√™s'},
  ];
  const nichoOptions = [
    {v:'clinica',l:'üè• Cl√≠nica M√©dica/Est√©tica'},
    {v:'restaurante',l:'üçï Restaurante/Gastronomia'},
    {v:'academia',l:'üí™ Academia/Fitness'},
    {v:'advocacia',l:'‚öñÔ∏è Advocacia/Jur√≠dico'},
    {v:'imoveis',l:'üè† Im√≥veis'},
    {v:'salao',l:'üíá Sal√£o de Beleza'},
  ];
  const nichoAvatars = {clinica:'üè•',restaurante:'üçï',academia:'üí™',advocacia:'‚öñÔ∏è',imoveis:'üè†',salao:'üíá'};
  const planLabels = {basico:'B√ÅSICO',pro:'PRO',premium:'PREMIUM'};
  const planPrices = {basico:999,pro:1299,premium:1499};

  return `
    <div class="ff"><label class="fl">Nome do Neg√≥cio <span style="color:var(--orange)">*</span></label><input class="fi" id="nc-name" placeholder="Ex: Cl√≠nica Bella Est√©tica" value="${c?c.name:''}"/></div>
    <div class="ff"><label class="fl">Nicho</label>
      <select class="fi" id="nc-nicho">
        ${nichoOptions.map(n=>`<option value="${n.v}" ${c&&c.nicho===n.v?'selected':''}>${n.l}</option>`).join('')}
      </select>
    </div>
    <div class="row2">
      <div class="ff"><label class="fl">Plano</label>
        <select class="fi" id="nc-plan">
          ${planOptions.map(p=>`<option value="${p.v}" ${c&&c.plan===p.v?'selected':''}>${p.l}</option>`).join('')}
        </select>
      </div>
      <div class="ff"><label class="fl">Status</label>
        <select class="fi" id="nc-status">
          <option value="active" ${!c||c.status==='active'?'selected':''}>‚úÖ Ativo</option>
          <option value="trial" ${c&&c.status==='trial'?'selected':''}>üü° Trial</option>
          <option value="paused" ${c&&c.status==='paused'?'selected':''}>‚è∏Ô∏è Pausado</option>
        </select>
      </div>
    </div>
    <div class="ff"><label class="fl">E-mail de acesso do cliente <span style="color:var(--orange)">*</span></label><input class="fi" id="nc-email" type="email" placeholder="cliente@empresa.com" value="${c?c.email:''}"/></div>
    <div class="ff">
      <label class="fl">${c?'Nova senha (deixe em branco para manter)':'Senha de acesso'} <span style="color:var(--orange)">${c?'':'*'}</span></label>
      <div class="pw-wrap">
        <input class="fi" type="password" id="nc-pass" placeholder="${c?'‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢':'M√≠nimo 6 caracteres'}" autocomplete="new-password"/>
        <button class="pw-toggle" type="button" onclick="togglePw('nc-pass',this)">üëÅ</button>
      </div>
    </div>
    ${!c?`<div style="font-size:11px;color:var(--muted);background:rgba(56,182,255,.05);border:1px solid rgba(56,182,255,.1);border-radius:var(--rs);padding:10px 12px;margin-top:-8px;">üí° Guarde as credenciais para compartilhar com o cliente. O navegador pode oferecer para salvar automaticamente.</div>`:''}
  `;
}

function addClientModal() {
  document.getElementById('mTitle').textContent = '‚ûï Novo Cliente';
  document.getElementById('mDesc').textContent = 'Configure um novo agente SDR. As credenciais criadas ser√£o usadas pelo cliente para acessar o painel.';
  document.getElementById('mBody').innerHTML = clientFormHTML(null);
  document.getElementById('mOk').textContent = 'üöÄ Criar Cliente';
  document.getElementById('mOk').onclick = confirmAddClient;
  document.getElementById('mainModal').classList.add('open');
}

function editClientModal(id) {
  const c = clients.find(x => x.id === id);
  if (!c) return;
  document.getElementById('mTitle').textContent = '‚úèÔ∏è Editar Cliente';
  document.getElementById('mDesc').textContent = `Editando: ${c.name}`;
  document.getElementById('mBody').innerHTML = clientFormHTML(c);
  document.getElementById('mOk').textContent = 'üíæ Salvar Altera√ß√µes';
  document.getElementById('mOk').onclick = () => confirmEditClient(id);
  document.getElementById('mainModal').classList.add('open');
}

function confirmAddClient() {
  const name = document.getElementById('nc-name')?.value?.trim();
  const email = document.getElementById('nc-email')?.value?.trim();
  const pass = document.getElementById('nc-pass')?.value;
  if (!name) { showToast('‚ö†Ô∏è Preencha o nome'); return; }
  if (!email) { showToast('‚ö†Ô∏è Preencha o e-mail'); return; }
  if (!pass || pass.length < 6) { showToast('‚ö†Ô∏è Senha deve ter ao menos 6 caracteres'); return; }

  const nicho = document.getElementById('nc-nicho')?.value || 'clinica';
  const plan = document.getElementById('nc-plan')?.value || 'basico';
  const status = document.getElementById('nc-status')?.value || 'active';
  const nichoAvatars = {clinica:'üè•',restaurante:'üçï',academia:'üí™',advocacia:'‚öñÔ∏è',imoveis:'üè†',salao:'üíá'};
  const nichoLabels = {clinica:'üè• Cl√≠nica M√©dica',restaurante:'üçï Restaurante',academia:'üí™ Academia',advocacia:'‚öñÔ∏è Advocacia',imoveis:'üè† Im√≥veis',salao:'üíá Sal√£o'};
  const planLabels = {basico:'B√ÅSICO',pro:'PRO',premium:'PREMIUM'};
  const planPrices = {basico:999,pro:1299,premium:1499};
  const newId = Date.now();

  clients.push({
    id: newId, name, nicho, avatar: nichoAvatars[nicho], nichoLabel: nichoLabels[nicho],
    plan, planLabel: planLabels[plan], planPrice: planPrices[plan],
    status, leads: 0, hot: 0, conv: 0, score: 0, email, pass
  });
  saveClients(clients);
  closeModal();
  renderClients();
  updateAgencyStats();
  showToast(`‚úÖ Cliente "${name}" criado! Login: ${email}`);
}

function confirmEditClient(id) {
  const idx = clients.findIndex(x => x.id === id);
  if (idx < 0) return;
  const name = document.getElementById('nc-name')?.value?.trim();
  const email = document.getElementById('nc-email')?.value?.trim();
  const pass = document.getElementById('nc-pass')?.value;
  if (!name || !email) { showToast('‚ö†Ô∏è Preencha nome e e-mail'); return; }

  const nicho = document.getElementById('nc-nicho')?.value || clients[idx].nicho;
  const plan = document.getElementById('nc-plan')?.value || clients[idx].plan;
  const status = document.getElementById('nc-status')?.value || clients[idx].status;
  const nichoAvatars = {clinica:'üè•',restaurante:'üçï',academia:'üí™',advocacia:'‚öñÔ∏è',imoveis:'üè†',salao:'üíá'};
  const nichoLabels = {clinica:'üè• Cl√≠nica M√©dica',restaurante:'üçï Restaurante',academia:'üí™ Academia',advocacia:'‚öñÔ∏è Advocacia',imoveis:'üè† Im√≥veis',salao:'üíá Sal√£o'};
  const planLabels = {basico:'B√ÅSICO',pro:'PRO',premium:'PREMIUM'};
  const planPrices = {basico:999,pro:1299,premium:1499};

  clients[idx] = {
    ...clients[idx], name, email, nicho,
    avatar: nichoAvatars[nicho], nichoLabel: nichoLabels[nicho],
    plan, planLabel: planLabels[plan], planPrice: planPrices[plan], status,
    pass: pass && pass.length >= 6 ? pass : clients[idx].pass
  };
  saveClients(clients);
  closeModal();
  renderClients();
  updateAgencyStats();
  showToast(`‚úÖ Cliente "${name}" atualizado!`);
}

function confirmDelete(id, name) {
  document.getElementById('confirm-msg').textContent = `Remover "${name}" permanentemente? Todos os dados ser√£o apagados.`;
  document.getElementById('confirm-ok').onclick = () => {
    clients = clients.filter(c => c.id !== id);
    saveClients(clients);
    closeConfirm();
    renderClients();
    updateAgencyStats();
    showToast(`üóëÔ∏è Cliente "${name}" removido.`);
  };
  document.getElementById('confirmModal').classList.add('open');
}
function closeConfirm() { document.getElementById('confirmModal').classList.remove('open'); }
function closeModal() { document.getElementById('mainModal').classList.remove('open'); }
document.getElementById('mainModal').addEventListener('click', e => { if (e.target === document.getElementById('mainModal')) closeModal(); });
document.getElementById('confirmModal').addEventListener('click', e => { if (e.target === document.getElementById('confirmModal')) closeConfirm(); });

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const titles = {dash:'Dashboard',agente:'ü§ñ Agente SDR',leads:'üë• Leads',funil:'üîª Funil',treinamento:'üß† Treinamento',whatsapp:'üì± WhatsApp (Zapi)',config:'‚öôÔ∏è Configura√ß√µes'};
function showView(id, btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  const el = document.getElementById('view-' + id);
  if (el) el.classList.add('active');
  document.querySelectorAll('.nb').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  const pt = document.getElementById('pageTitle');
  if (pt) pt.textContent = titles[id] || id;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHotTable() {
  const hot = leadsData.filter(l => l.temp === 'hot').slice(0, 4);
  const tbody = document.getElementById('hotTbl');
  if (!tbody) return;
  tbody.innerHTML = hot.map(l => `
    <tr>
      <td><div class="tname">${l.name}</div><div class="tsub">${l.biz}</div></td>
      <td><span class="temp t-hot">üî• Quente</span></td>
      <td><span class="pmini"><span class="pfill" style="width:${l.score}%"></span></span> <span style="font-size:10px;color:var(--orange);">${l.score}%</span></td>
      <td><span class="sbadge s3">${l.stage}</span></td>
      <td><button class="btn btn-green btn-xs" onclick="sendToWA('${l.name}')">üì± WA</button></td>
    </tr>
  `).join('');
}

function renderAllTable() {
  const tbody = document.getElementById('allTbl');
  if (!tbody) return;
  const tc = {hot:'t-hot',warm:'t-warm',cold:'t-cold'};
  const tl = {hot:'üî• Quente',warm:'üå°Ô∏è Morno',cold:'‚ùÑÔ∏è Frio'};
  tbody.innerHTML = leadsData.map(l => `
    <tr>
      <td><div class="tname">${l.name}</div><div class="tsub">${l.biz}</div></td>
      <td><span class="temp ${tc[l.temp]}">${tl[l.temp]}</span></td>
      <td><span class="pmini"><span class="pfill" style="width:${l.score}%"></span></span> <span style="font-size:10px;color:var(--orange);">${l.score}%</span></td>
      <td><span class="sbadge s2">${l.stage}</span></td>
      <td style="font-size:10px;color:var(--muted);">${l.date}</td>
      <td>${l.temp==='hot'?`<button class="btn btn-green btn-xs" onclick="sendToWA('${l.name}')">üì± WA</button>`:`<button class="btn btn-ghost btn-xs">Ver</button>`}</td>
    </tr>
  `).join('');
}

function exportHot() { showToast(`üì± Leads quentes enviados ao WhatsApp!`); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AI CHAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildPrompt(nicho) {
  const d = nichoData[nicho] || nichoData.clinica;
  return `Voc√™ √© ${d.persona} trabalhando para ${d.negocio}. Voc√™ √© um SDR especialista em ${d.name}.\n\nSERVI√áOS: ${d.servicos}\nOBJETIVO: Qualificar leads e conduzi-los at√© o CTA: "${d.cta}". Voc√™ N√ÉO fecha a venda ‚Äî entrega leads quentes ao vendedor humano.\nTOM: ${d.tom}. Mensagens curtas como WhatsApp. M√°x 2-3 par√°grafos. Emojis moderados.\nOBJE√á√ïES: ${d.objecoes}\n\nFUNIL: Consci√™ncia‚ÜíInteresse‚ÜíConsidera√ß√£o‚ÜíDecis√£o‚ÜíLead Quente\nQuando o lead demonstrar alta inten√ß√£o (disponibilidade + interesse real), inclua exatamente: [LEAD_QUENTE]\nNunca invente pre√ßos. N√£o repita a sauda√ß√£o se j√° foi feita. Pergunte UMA coisa por vez.\nResponda SEMPRE em portugu√™s brasileiro.`;
}

async function callAI(msg, nicho) {
  app.history.push({ role: 'user', content: msg });
  const key = app.apiKey;
  if (!key) return getFallback(nicho, app.msgCount);
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'x-api-key': key, 'anthropic-version': '2023-06-01' },
      body: JSON.stringify({ model: app.model, max_tokens: 800, system: buildPrompt(nicho), messages: app.history })
    });
    const data = await res.json();
    if (data.error) return getFallback(nicho, app.msgCount);
    const reply = data.content?.[0]?.text || 'Desculpe, tente novamente.';
    app.history.push({ role: 'assistant', content: reply });
    return reply;
  } catch (e) { return getFallback(nicho, app.msgCount); }
}

function getFallback(nicho, count) {
  const list = fallbackMsgs[nicho] || fallbackMsgs.clinica;
  return list[Math.min(count, list.length - 1)];
}

function getNicho() {
  const v = document.querySelector('.view.active');
  if (v?.id === 'view-agente') return document.getElementById('nichoSel2')?.value || 'clinica';
  return app.currentClient?.nicho || 'clinica';
}

function getWelcome(nicho) {
  const d = nichoData[nicho] || nichoData.clinica;
  const name = d.persona.split(',')[0];
  const w = {
    clinica:`Ol√°! üòä Seja bem-vindo √† ${d.negocio}! Sou ${name} e estou aqui para te ajudar. O que te trouxe at√© aqui hoje?`,
    restaurante:`Ol√°! üëã Bem-vindo ao ${d.negocio}! Sou ${name}. Como posso tornar sua experi√™ncia incr√≠vel hoje?`,
    academia:`E a√≠! üí™ Bem-vindo √† ${d.negocio}! Sou ${name}. Qual √© o seu objetivo de transforma√ß√£o?`,
    advocacia:`Ol√°! üëã Bem-vindo ao ${d.negocio}. Sou ${name}. Como posso te orientar hoje?`,
    imoveis:`Ol√°! üè† Bem-vindo √† ${d.negocio}! Sou ${name}. O que voc√™ est√° buscando no mercado imobili√°rio?`,
    salao:`Oi! ‚ú® Bem-vindo ao ${d.negocio}! Sou ${name}. O que voc√™ quer arrasar hoje?`,
  };
  return w[nicho] || w.clinica;
}

function resetChat() {
  app.history = []; app.score = 0; app.stage = -1; app.msgCount = 0;
  ['chatWin2'].forEach(id => {
    const el = document.getElementById(id); if (el) el.innerHTML = '';
  });
  const nicho = getNicho();
  const welcome = getWelcome(nicho);
  addBubble(welcome, 'ai', -1, true);
  app.history.push({ role: 'assistant', content: welcome });
  updateScoreUI(0, -1);
  setEl('leadName', 'Aguardando...');
  setEl('leadSub', 'Inicie uma conversa');
  const la = document.getElementById('leadAva'); if (la) la.textContent = 'üë§';
  const wb2 = document.getElementById('waBtn2'); if (wb2) wb2.disabled = true;
  const lt = document.getElementById('leadTags'); if (lt) lt.innerHTML = '<span class="tag">üí¨ Aguardando</span>';
  setEl('score-display', 'Score: ‚Äî');
}

async function sendMsg(inputId, winId, btnId) {
  const inp = document.getElementById(inputId);
  const btn = document.getElementById(btnId);
  if (!inp || btn?.disabled) return;
  const text = inp.value.trim(); if (!text) return;
  inp.value = ''; inp.style.height = 'auto';
  if (btn) btn.disabled = true;
  addBubble(text, 'lead', -1, true);
  showTyping();
  const nicho = getNicho();
  const reply = await callAI(text, nicho);
  hideTyping();
  const isHot = reply.includes('[LEAD_QUENTE]');
  app.msgCount++;
  updateScoreUI(app.msgCount, isHot ? 4 : Math.min(Math.floor(app.msgCount / 1.2), 3));
  addBubble(reply, 'ai', app.stage, true);
  if (isHot) setTimeout(() => {
    showToast('üî• Lead Quente! Notificando vendedor...');
    const wb2 = document.getElementById('waBtn2'); if (wb2) wb2.disabled = false;
  }, 400);
  if (btn) btn.disabled = false;
  inp.focus();
}

function addBubble(text, role, stage, scroll) {
  const clean = text.replace('[LEAD_QUENTE]', '').trim();
  const wins = [document.getElementById('chatWin2')].filter(Boolean);
  const stageCls = ['s0','s1','s2','s3','s4'];
  const stageNm = ['Consci√™ncia','Interesse','Considera√ß√£o','Decis√£o','üî• Lead Quente'];
  wins.forEach(win => {
    const row = document.createElement('div');
    row.className = 'bubble-row ' + (role === 'lead' ? 'lr' : '');
    row.innerHTML = `
      <div class="av ${role==='ai'?'ai':'lead'}">${role==='ai'?'SDR':'üë§'}</div>
      <div class="bdy">
        <div class="bsender">${role==='ai'?'Agente SDR ‚Äî IA':'Voc√™ (Lead)'}</div>
        <div class="bubble ${role==='ai'?'ai-bub':'lead-bub'}">${clean}</div>
        ${role==='ai'&&stage>=0?`<span class="sbadge ${stageCls[stage]}">${stageNm[stage]}</span>`:''}
      </div>`;
    win.appendChild(row);
    if (scroll) win.scrollTop = win.scrollHeight;
  });
}

function showTyping() {
  const win = document.getElementById('chatWin2'); if (!win) return;
  const r = document.createElement('div'); r.className = 'typing-row'; r.id = 'tr_chat';
  r.innerHTML = `<div class="av ai">SDR</div><div class="tbub"><div class="td"></div><div class="td"></div><div class="td"></div></div>`;
  win.appendChild(r); win.scrollTop = win.scrollHeight;
}
function hideTyping() { document.getElementById('tr_chat')?.remove(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCORE & JOURNEY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateScoreUI(msgCount, stage) {
  app.stage = stage;
  let score = 0;
  if (stage >= 0) {
    const base = [20, 38, 56, 72, 88];
    score = Math.min((base[stage] || 80) + Math.floor(Math.random() * 8), 100);
  }
  app.score = score;
  const pct = score + '%';
  const stNames = ['Consci√™ncia','Interesse','Considera√ß√£o','Decis√£o','üî• Quente'];
  const stColors = ['var(--purple)','var(--blue)','var(--orange)','#00d4ff','var(--pink)'];
  const tempLbls = ['‚ùÑÔ∏è Frio','‚ùÑÔ∏è Frio','üå°Ô∏è Morno','üå°Ô∏è Morno','üî• Quente'];
  const intLbls = ['‚ùÑÔ∏è Baixa','‚ùÑÔ∏è Baixa','üå°Ô∏è M√©dia','üî• Alta','üî• Muito Alta'];

  setEl('score-display', 'Score: ' + pct);
  setEl('sc2', pct, 'var(--orange)');
  if (stage >= 0) {
    setEl('tp2', tempLbls[stage]);
    setEl('in2', intLbls[stage]);
  }

  const sf = document.getElementById('scoreFill'); if (sf) sf.style.width = pct;

  const jtrack = document.getElementById('jtrack2');
  if (jtrack) {
    jtrack.querySelectorAll('.jstep').forEach((s, i) => {
      const d = s.querySelector('.jdot'); d.className = 'jdot';
      const icons = ['üîç','üí°','‚öñÔ∏è','üéØ','ü§ù'];
      if (i < stage) { d.classList.add('done'); d.textContent = '‚úì'; }
      else if (i === stage) { d.classList.add('now'); d.textContent = icons[i]; }
      else { d.classList.add('todo'); d.textContent = icons[i]; }
    });
  }

  if (msgCount >= 1) {
    setEl('leadName', 'Lead #' + String(100 + msgCount).padStart(3, '0'));
    setEl('leadSub', (nichoData[getNicho()]?.name || 'Prospect') + ' ‚Äî Em qualifica√ß√£o');
    const la = document.getElementById('leadAva'); if (la) la.textContent = 'üßë';
  }

  const lt = document.getElementById('leadTags');
  if (lt) {
    let tags = [];
    if (score >= 70) tags.push('<span class="tag" style="color:var(--orange);border-color:rgba(255,101,53,.3);">üî• Alta inten√ß√£o</span>');
    if (stage >= 3) tags.push('<span class="tag" style="color:var(--green);border-color:rgba(0,230,118,.3);">üìÖ Dispon√≠vel</span>');
    if (msgCount >= 2) tags.push('<span class="tag">üí¨ Engajado</span>');
    lt.innerHTML = tags.join('') || '<span class="tag">üí¨ Em contato</span>';
  }
}

function setEl(id, txt, color) {
  const e = document.getElementById(id);
  if (e) { e.textContent = txt; if (color) e.style.color = color; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WHATSAPP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openWA() {
  const wa = app.waNumber || localStorage.getItem('p_wa') || '5511999999999';
  const nicho = getNicho();
  const msg = encodeURIComponent(`üî• *LEAD QUENTE ‚Äî Pulsar SDR*\n\nScore: ${app.score}%\nNicho: ${nichoData[nicho]?.name || 'Neg√≥cio local'}\n\nLead qualificado pelo Agente SDR. Pronto para fechamento! üí™`);
  window.open(`https://wa.me/${wa}?text=${msg}`, '_blank');
}
function sendToWA(name) {
  const wa = app.waNumber || localStorage.getItem('p_wa') || '5511999999999';
  const msg = encodeURIComponent(`üî• Lead Quente: ${name}\nQualificado pelo Agente SDR Pulsar ‚Äî Pronto para fechamento!`);
  window.open(`https://wa.me/${wa}?text=${msg}`, '_blank');
}
function hk(e, ci, sb) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg(ci, 'chatWin2', sb); } }

function copyField(id) {
  const el = document.getElementById(id);
  if (el) navigator.clipboard.writeText(el.value || el.textContent || '').then(() => showToast('üìã Copiado!'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// API KEY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveAgencyApiKey() {
  const key = document.getElementById('agencyApiKey')?.value?.trim();
  const model = document.getElementById('agencyModel')?.value;
  if (!key || !key.startsWith('sk-')) { showToast('‚ö†Ô∏è Insira uma chave v√°lida (come√ßa com sk-)'); return; }
  localStorage.setItem('pulsar_agency_apikey', key);
  if (model) localStorage.setItem('pulsar_agency_model', model);
  app.apiKey = key; app.model = model || app.model;
  updateApiStatusBadge(key);
  showToast('‚úÖ API Key salva! Todos os clientes usando IA real agora.');
}
function checkApiKey(val) { updateApiStatusBadge(val); }
function updateApiStatusBadge(key) {
  const badge = document.getElementById('apiStatusBadge'); if (!badge) return;
  if (key && key.startsWith('sk-') && key.length > 20) {
    badge.textContent = '‚úÖ Ativa'; badge.style.cssText = 'font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(0,230,118,.12);color:var(--green);border:1px solid rgba(0,230,118,.2);';
  } else {
    badge.textContent = 'N√£o configurada'; badge.style.cssText = 'font-size:10px;font-weight:700;padding:3px 9px;border-radius:20px;background:rgba(255,71,87,.12);color:var(--red);border:1px solid rgba(255,71,87,.2);';
  }
}
function toggleApiKeyVisibility() {
  const inp = document.getElementById('agencyApiKey'); if (!inp) return;
  inp.type = inp.type === 'password' ? 'text' : 'password';
}
function saveClientWA() {
  const wa = document.getElementById('waInp')?.value?.trim();
  if (wa) { app.waNumber = wa; localStorage.setItem('p_wa', wa); }
  showToast('‚úÖ N√∫mero salvo!');
}
function openSupportWA() {
  const msg = encodeURIComponent('Ol√°! Preciso de suporte com o Pulsar SDR.');
  window.open('https://wa.me/5511999999999?text=' + msg, '_blank');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(msg) {
  document.getElementById('tMsg').textContent = msg;
  const t = document.getElementById('toast');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTO-RESIZE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.chat-in').forEach(inp => {
  inp.addEventListener('input', function() { this.style.height = 'auto'; this.style.height = Math.min(this.scrollHeight, 100) + 'px'; });
});

// INIT
window.addEventListener('load', () => {
  const k = localStorage.getItem('pulsar_agency_apikey');
  if (k) app.apiKey = k;
  const m = localStorage.getItem('pulsar_agency_model');
  if (m) app.model = m;
  const wa = localStorage.getItem('p_wa');
  if (wa) app.waNumber = wa;
});
</script>
</body>
</html>
